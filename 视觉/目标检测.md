# æ ‡ç­¾æ ‡æ³¨

## æ ‡æ³¨å·¥å…·

### labelme(åç»­æ ‡æ³¨ç»“æœä»¥labelmeä¸ºé»˜è®¤å·¥å…·)

å®˜ç½‘ï¼šhttps://github.com/wkentaro/labelme

å®‰è£…

pipï¼ˆæ¨èï¼‰

```sh
#æœ€å¥½å…ˆcondaå…ˆåˆ›å»ºç¯å¢ƒç„¶åå†å®‰è£…ï¼Œé˜²æ­¢åŒ…å†²çªï¼Œæ¨èpythonç‰ˆæœ¬ä¸º3.10
# å®‰è£…
pip install labelme

# è¿è¡Œ
labelme
```



æ‰“åŒ…ä¸ºå¯æ‰§è¡Œæ–‡ä»¶ï¼šï¼ˆä¸æ¨èï¼‰

```sh
LABELME_PATH=./labelme
OSAM_PATH=$(python -c 'import os, osam; print(os.path.dirname(osam.__file__))')
pyinstaller labelme/labelme/__main__.py \
  --name=Labelme \
  --windowed \
  --noconfirm \
  --specpath=build \
  --add-data=$(OSAM_PATH)/_models/yoloworld/clip/bpe_simple_vocab_16e6.txt.gz:osam/_models/yoloworld/clip \
  --add-data=$(LABELME_PATH)/config/default_config.yaml:labelme/config \
  --add-data=$(LABELME_PATH)/icons/*:labelme/icons \
  --add-data=$(LABELME_PATH)/translate/*:translate \
  --icon=$(LABELME_PATH)/icons/icon-256.png \
  --onedir
```

### labelimgï¼ˆä¸ªäººæ„Ÿè§‰æ¯”labelmeå¥½ç”¨ï¼‰

é»˜è®¤æ”¯æŒvocå’Œyoloæ ‡ç­¾å¯¼å‡ºï¼Œè€Œlabelmeéœ€è¦proç‰ˆæœ¬æ‰æ”¯æŒ



å®˜ç½‘ï¼š

https://github.com/HumanSignal/labelImg.git

å®‰è£…ï¼š

pip

```python
# æ¨èpythonç‰ˆæœ¬ 3.9
# ä¾èµ–åŒ…
# pip install PyQt5
# pip install pyqt5-tools
# pip install lxml

pip install labelimg
```

æ‰“åŒ…ä¸ºå¯æ‰§è¡Œæ–‡ä»¶ï¼ˆä¸æ¨èï¼‰

```
Install pyinstaller and execute:

pip install pyinstaller
pyinstaller --hidden-import=pyqt5 --hidden-import=lxml -F -n "labelImg" -c labelImg.py -p ./libs -p ./
```



è¿è¡Œï¼š

```
labelimg
```



## æ ‡æ³¨ç»“æœ

```
{
    "version": "5.0.1",                  // LabelMeè½¯ä»¶çš„ç‰ˆæœ¬å·
    "flags": {},                        // ç”¨æˆ·å®šä¹‰çš„æ ‡å¿—æˆ–æ³¨é‡Š
    "shapes": [                         // å›¾åƒä¸­æ‰€æœ‰æ ‡æ³¨çš„é›†åˆ
        {
            "label": "car",             // æ ‡æ³¨å¯¹è±¡çš„ç±»åˆ«æ ‡ç­¾
            "points": [[10, 20], [30, 40]], // å¤šè¾¹å½¢é¡¶ç‚¹åæ ‡ï¼Œå¯¹äºçŸ©å½¢æ˜¯ä¸¤å¯¹è§’ç‚¹
            "group_id": null,           // å¯é€‰çš„ç»„IDï¼Œç”¨äºå…³è”å¤šä¸ªå½¢çŠ¶
            "shape_type": "rectangle",  // å½¢çŠ¶ç±»å‹ï¼šrectangle, polygon, points, line, etc.
            "flags": {}                 // å½¢çŠ¶ç‰¹å®šçš„æ ‡å¿—
        },
        // æ›´å¤šçš„å½¢çŠ¶...
    ],
    "imagePath": "path/to/image.jpg",   // åŸå§‹å›¾åƒçš„ç›¸å¯¹è·¯å¾„
    "imageData": null,                  // å›¾åƒçš„Base64ç¼–ç ï¼Œå¦‚æœå›¾åƒæ–‡ä»¶è¾ƒå¤§ï¼Œé€šå¸¸ä¸ºç©º
    "imageHeight": 480,                 // å›¾åƒçš„é«˜åº¦
    "imageWidth": 640                   // å›¾åƒçš„å®½åº¦
}
```



## æ³¨æ„äº‹é¡¹

1.æ ‡ç­¾æ ‡æ³¨å‰ï¼Œå°½é‡å…ˆå†™æ ‡ç­¾æ–‡ä»¶èŠ‚çœæ‰“æ ‡ç­¾æ—¶é—´

é¢„å…ˆæŠŠæ•°æ®é›†çš„ç±»åˆ«å†™å…¥txt

ä¾‹å¦‚æ–°å»ºlabel.txt

```
bus
car
motorcycle
truck
```

åœ¨labelmeå¯åŠ¨æ—¶åŠ å…¥å‚æ•°æŒ‡å®šlabelæ–‡ä»¶ä½ç½®

ä¾‹å¦‚

```sh
labelme --labels label.txt
```

2.æ ‡ç­¾æ–‡ä»¶é»˜è®¤ç”Ÿæˆåœ¨å›¾ç‰‡ç›¸åŒç›®å½•ä¸‹ï¼Œå¦‚æœéœ€è¦ä¿®æ”¹ç›®å½•å¯ä»¥ç‚¹å‡»â€æ›´æ”¹è¾“å‡ºç›®å½•â€œ

3.å–æ¶ˆå‹¾é€‰â€åŒæ—¶ä¿å­˜å›¾åƒæ•°æ®â€œï¼Œè¿™ä¸€é¡¹é»˜è®¤å‹¾é€‰ï¼Œå‹¾é€‰åä¼šæŠŠå›¾åƒè¿›è¡Œbase64ç¼–ç ä¿å­˜è‡³jsonï¼Œæ²¡æœ‰å¿…è¦

4.labelmeé»˜è®¤è¯»å– â€changeOutputDirâ€å˜é‡æ‰€æŒ‡çš„ç›®å½•æ¥åŠ è½½æ ‡ç­¾ å³â€œæ›´æ”¹è¾“å‡ºç›®å½•â€æ‰€æŒ‡å‘çš„ç›®å½•ï¼ˆhttps://github.com/wkentaro/labelme/blob/e248eae029e905aeddcb96b4be17e2c643b1e18f/labelme/app.py#L303C9-L303C23ï¼‰



## å…¶ä»–ç”¨æ³•

ä½œä¸ºåº“ä½¿ç”¨

[ã€å›¾åƒåˆ†å‰²ã€‘LabelMeåŸºæœ¬ä½¿ç”¨/æ ‡æ³¨æ ‡ç­¾æ ¼å¼è½¬æ¢åŠå¯è§†åŒ–-è…¾è®¯äº‘å¼€å‘è€…ç¤¾åŒº-è…¾è®¯äº‘](https://cloud.tencent.com/developer/article/2274889)



```python
import labelme

```



# æ•°æ®é›†ç±»å‹

## å‚è€ƒ

[(29 å°ç§ä¿¡ / 80 æ¡æ¶ˆæ¯) ã€ç›®æ ‡æ£€æµ‹ã€‘yoloçš„ä¸‰ç§æ•°æ®é›†æ ¼å¼ - çŸ¥ä¹](https://zhuanlan.zhihu.com/p/525950939)

## YOLOï¼ˆtxtï¼‰

![img](https://pica.zhimg.com/v2-d29ecbc37b52a305e5791d8d32e61db6_1440w.jpg)

å›¾ç‰‡å’Œæ ‡ç­¾åˆ†åˆ«ä¸¤ä¸ªæ–‡ä»¶å¤¹ä¸­ï¼Œå¹¶ä¸”è‡ªå·±åˆ†ç±»ï¼Œå°†å›¾ç‰‡ä¸æ ‡ç­¾æŒ‰ç…§ä¸€å®šçš„æ¯”ä¾‹åŒºåˆ†æˆè®­ç»ƒé›†å’ŒéªŒè¯é›†ã€‚

![img](https://pica.zhimg.com/v2-3b05de815cf88c3249395c4531101c8a_1440w.jpg)

ç¬¬ä¸€åˆ—ä¸ºç›®æ ‡ç±»åˆ«ï¼Œåé¢å››ä¸ªæ•°å­—ä¸º**[x_center, y_center, w, h]**ï¼Œå¯ä»¥çœ‹åˆ°éƒ½æ˜¯å°äº1çš„æ•°å­—ï¼Œæ˜¯å› ä¸ºå¯¹åº”çš„æ•´å¼ å›¾ç‰‡çš„æ¯”ä¾‹ï¼Œæ‰€ä»¥å°±ç®—å›¾åƒè¢«æ‹‰ä¼¸æ”¾ç¼©ï¼Œè¿™ç§txtæ ¼å¼çš„æ ‡ç­¾ä¹Ÿå¯ä»¥æ‰¾åˆ°ç›¸åº”çš„ç›®æ ‡ã€‚

yamlé…ç½®

![img](https://pic1.zhimg.com/v2-dee90a1bae3d230d43b59978c43e8e72_1440w.jpg)





## Pascal VOCï¼ˆxmlï¼‰

![img](https://pic3.zhimg.com/v2-9b5df21cabfed7da427d113034133230_1440w.jpg)

â‘  JPEGImagesæ–‡ä»¶å¤¹ï¼šæ•°æ®é›†å›¾ç‰‡

â‘¡ Annotationsæ–‡ä»¶å¤¹ï¼šæ ‡æ³¨ï¼Œä¸å›¾ç‰‡å¯¹åº”çš„xmlæ–‡ä»¶

â‘¢ ImageSets/Mainæ–‡ä»¶å¤¹ï¼šå°†æ•°æ®é›†åˆ†ä¸ºè®­ç»ƒé›†å’ŒéªŒè¯é›†ï¼Œå› æ­¤äº§ç”Ÿçš„train.txtå’Œval.txt

åŒºåˆ†è®­ç»ƒé›†ä¸éªŒè¯é›†çš„æ“ä½œé›†åœ¨äº†Imagesetsä¸­

![img](https://pica.zhimg.com/v2-2ead680d000aef85c28b6249aa224bb0_1440w.jpg)

## COCOï¼ˆjsonï¼‰



## æ ¼å¼è½¬æ¢

### txt2xml

```python
from xml.dom.minidom import Document
import os
import cv2


# def makexml(txtPath, xmlPath, picPath):  # txtæ‰€åœ¨æ–‡ä»¶å¤¹è·¯å¾„ï¼Œxmlæ–‡ä»¶ä¿å­˜è·¯å¾„ï¼Œå›¾ç‰‡æ‰€åœ¨æ–‡ä»¶å¤¹è·¯å¾„
def makexml(picPath, txtPath, xmlPath):  # txtæ‰€åœ¨æ–‡ä»¶å¤¹è·¯å¾„ï¼Œxmlæ–‡ä»¶ä¿å­˜è·¯å¾„ï¼Œå›¾ç‰‡æ‰€åœ¨æ–‡ä»¶å¤¹è·¯å¾„
    """æ­¤å‡½æ•°ç”¨äºå°†yoloæ ¼å¼txtæ ‡æ³¨æ–‡ä»¶è½¬æ¢ä¸ºvocæ ¼å¼xmlæ ‡æ³¨æ–‡ä»¶
    åœ¨è‡ªå·±çš„æ ‡æ³¨å›¾ç‰‡æ–‡ä»¶å¤¹ä¸‹å»ºä¸‰ä¸ªå­æ–‡ä»¶å¤¹ï¼Œåˆ†åˆ«å‘½åä¸ºpictureã€txtã€xml
    """
    dic = {'0': "bus",  # åˆ›å»ºå­—å…¸ç”¨æ¥å¯¹ç±»å‹è¿›è¡Œè½¬æ¢
           '1': "car",  # æ­¤å¤„çš„å­—å…¸è¦ä¸è‡ªå·±çš„classes.txtæ–‡ä»¶ä¸­çš„ç±»å¯¹åº”ï¼Œä¸”é¡ºåºè¦ä¸€è‡´
           '2': "truck",
           }
    files = os.listdir(txtPath)
    for i, name in enumerate(files):
        xmlBuilder = Document()
        annotation = xmlBuilder.createElement("annotation")  # åˆ›å»ºannotationæ ‡ç­¾
        xmlBuilder.appendChild(annotation)
        txtFile = open(txtPath + name)
        txtList = txtFile.readlines()
        img = cv2.imread(picPath + name[0:-4] + ".jpg")
        Pheight, Pwidth, Pdepth = img.shape

        folder = xmlBuilder.createElement("folder")  # folderæ ‡ç­¾
        foldercontent = xmlBuilder.createTextNode("driving_annotation_dataset")
        folder.appendChild(foldercontent)
        annotation.appendChild(folder)  # folderæ ‡ç­¾ç»“æŸ

        filename = xmlBuilder.createElement("filename")  # filenameæ ‡ç­¾
        filenamecontent = xmlBuilder.createTextNode(name[0:-4] + ".jpg")
        filename.appendChild(filenamecontent)
        annotation.appendChild(filename)  # filenameæ ‡ç­¾ç»“æŸ

        size = xmlBuilder.createElement("size")  # sizeæ ‡ç­¾
        width = xmlBuilder.createElement("width")  # sizeå­æ ‡ç­¾width
        widthcontent = xmlBuilder.createTextNode(str(Pwidth))
        width.appendChild(widthcontent)
        size.appendChild(width)  # sizeå­æ ‡ç­¾widthç»“æŸ

        height = xmlBuilder.createElement("height")  # sizeå­æ ‡ç­¾height
        heightcontent = xmlBuilder.createTextNode(str(Pheight))
        height.appendChild(heightcontent)
        size.appendChild(height)  # sizeå­æ ‡ç­¾heightç»“æŸ

        depth = xmlBuilder.createElement("depth")  # sizeå­æ ‡ç­¾depth
        depthcontent = xmlBuilder.createTextNode(str(Pdepth))
        depth.appendChild(depthcontent)
        size.appendChild(depth)  # sizeå­æ ‡ç­¾depthç»“æŸ

        annotation.appendChild(size)  # sizeæ ‡ç­¾ç»“æŸ

        for j in txtList:
            oneline = j.strip().split(" ")
            object = xmlBuilder.createElement("object")  # object æ ‡ç­¾
            picname = xmlBuilder.createElement("name")  # nameæ ‡ç­¾
            namecontent = xmlBuilder.createTextNode(dic[oneline[0]])
            picname.appendChild(namecontent)
            object.appendChild(picname)  # nameæ ‡ç­¾ç»“æŸ

            pose = xmlBuilder.createElement("pose")  # poseæ ‡ç­¾
            posecontent = xmlBuilder.createTextNode("Unspecified")
            pose.appendChild(posecontent)
            object.appendChild(pose)  # poseæ ‡ç­¾ç»“æŸ

            truncated = xmlBuilder.createElement("truncated")  # truncatedæ ‡ç­¾
            truncatedContent = xmlBuilder.createTextNode("0")
            truncated.appendChild(truncatedContent)
            object.appendChild(truncated)  # truncatedæ ‡ç­¾ç»“æŸ

            difficult = xmlBuilder.createElement("difficult")  # difficultæ ‡ç­¾
            difficultcontent = xmlBuilder.createTextNode("0")
            difficult.appendChild(difficultcontent)
            object.appendChild(difficult)  # difficultæ ‡ç­¾ç»“æŸ

            bndbox = xmlBuilder.createElement("bndbox")  # bndboxæ ‡ç­¾
            xmin = xmlBuilder.createElement("xmin")  # xminæ ‡ç­¾
            mathData = int(((float(oneline[1])) * Pwidth + 1) - (float(oneline[3])) * 0.5 * Pwidth)
            xminContent = xmlBuilder.createTextNode(str(mathData))
            xmin.appendChild(xminContent)
            bndbox.appendChild(xmin)  # xminæ ‡ç­¾ç»“æŸ

            ymin = xmlBuilder.createElement("ymin")  # yminæ ‡ç­¾
            mathData = int(((float(oneline[2])) * Pheight + 1) - (float(oneline[4])) * 0.5 * Pheight)
            yminContent = xmlBuilder.createTextNode(str(mathData))
            ymin.appendChild(yminContent)
            bndbox.appendChild(ymin)  # yminæ ‡ç­¾ç»“æŸ

            xmax = xmlBuilder.createElement("xmax")  # xmaxæ ‡ç­¾
            mathData = int(((float(oneline[1])) * Pwidth + 1) + (float(oneline[3])) * 0.5 * Pwidth)
            xmaxContent = xmlBuilder.createTextNode(str(mathData))
            xmax.appendChild(xmaxContent)
            bndbox.appendChild(xmax)  # xmaxæ ‡ç­¾ç»“æŸ

            ymax = xmlBuilder.createElement("ymax")  # ymaxæ ‡ç­¾
            mathData = int(((float(oneline[2])) * Pheight + 1) + (float(oneline[4])) * 0.5 * Pheight)
            ymaxContent = xmlBuilder.createTextNode(str(mathData))
            ymax.appendChild(ymaxContent)
            bndbox.appendChild(ymax)  # ymaxæ ‡ç­¾ç»“æŸ

            object.appendChild(bndbox)  # bndboxæ ‡ç­¾ç»“æŸ

            annotation.appendChild(object)  # objectæ ‡ç­¾ç»“æŸ

        f = open(xmlPath + name[0:-4] + ".xml", 'w')
        xmlBuilder.writexml(f, indent='\t', newl='\n', addindent='\t', encoding='utf-8')
        f.close()


if __name__ == "__main__":
    picPath = "./yolox/JPEGImages/"  # å›¾ç‰‡æ‰€åœ¨æ–‡ä»¶å¤¹è·¯å¾„ï¼Œåé¢çš„/ä¸€å®šè¦å¸¦ä¸Š
    txtPath = "./yolox/YOLO/"  # txtæ‰€åœ¨æ–‡ä»¶å¤¹è·¯å¾„ï¼Œåé¢çš„/ä¸€å®šè¦å¸¦ä¸Š
    xmlPath = "./yolox/Annotations/"  # xmlæ–‡ä»¶ä¿å­˜è·¯å¾„ï¼Œåé¢çš„/ä¸€å®šè¦å¸¦ä¸Š
    makexml(picPath, txtPath, xmlPath)
```

### json2yolo

```python
import json
import os

category_dict = {'é£æœº': '1'}  # ç±»åˆ«å­—å…¸

def json_to_yolo(input_file_path, output_directory):
    data = json.load(open(input_file_path, encoding="utf-8"))  # è¯»å–å¸¦æœ‰ä¸­æ–‡çš„æ–‡ä»¶
    image_width = data["imageWidth"]  # è·å–jsonæ–‡ä»¶é‡Œå›¾ç‰‡çš„å®½åº¦
    image_height = data["imageHeight"]  # è·å–jsonæ–‡ä»¶é‡Œå›¾ç‰‡çš„é«˜åº¦
    yolo_format_content = ''

    for shape in data["shapes"]:
        # å½’ä¸€åŒ–åæ ‡ç‚¹ï¼Œå¹¶è®¡ç®—ä¸­å¿ƒç‚¹(cx, cy)ã€å®½åº¦å’Œé«˜åº¦
        [[x1, y1], [x2, y2]] = shape['points']
        x1, x2 = x1 / image_width, x2 / image_width
        y1, y2 = y1 / image_height, y2 / image_height
        cx = (x1 + x2) / 2
        cy = (y1 + y2) / 2
        width = abs(x2 - x1)
        height = abs(y2 - y1)

        # å°†æ•°æ®ç»„è£…æˆYOLOæ ¼å¼
        line = "%s %.4f %.4f %.4f %.4f\n" % (category_dict[shape['label']], cx, cy, width, height)  # ç”Ÿæˆtxtæ–‡ä»¶é‡Œæ¯è¡Œçš„å†…å®¹
        yolo_format_content += line

    # ç”Ÿæˆtxtæ–‡ä»¶çš„ç›¸åº”æ–‡ä»¶è·¯å¾„
    output_file_path = os.path.join(output_directory, os.path.basename(input_file_path).replace('json', 'txt'))
    with open(output_file_path, 'w', encoding='utf-8') as file_handle:
        file_handle.write(yolo_format_content)


input_directory = "E:/DataSet/test/labels/"
output_directory = "E:/DataSet/test/labels-yolo/"

file_list = os.listdir(input_directory)
json_file_list = [file for file in file_list if file.endswith(".json")]  # è·å–æ‰€æœ‰jsonæ–‡ä»¶çš„è·¯å¾„

for json_file in json_file_list:
    json_to_yolo(os.path.join(input_directory, json_file), output_directory)
```

### voc2yolo

```py
import xml.etree.ElementTree as ET
import os
from os import getcwd
 
sets = ['train', 'val', 'test']
classes = ['Power-Pole'] # æ ¹æ®æ ‡ç­¾åç§°å¡«å†™ç±»åˆ«
abs_path = os.getcwd()
print(abs_path)
 
 
def convert(size, box):
    dw = 1. / (size[0])
    dh = 1. / (size[1])
    x = (box[0] + box[1]) / 2.0 - 1
    y = (box[2] + box[3]) / 2.0 - 1
    w = box[1] - box[0]
    h = box[3] - box[2]
    x = x * dw
    w = w * dw
    y = y * dh
    h = h * dh
    return x, y, w, h
 
 
def convert_annotation(image_id):
    in_file = open('data/Annotations/%s.xml' % (image_id), encoding='UTF-8')
    out_file = open('data/labels/%s.txt' % (image_id), 'w')
    tree = ET.parse(in_file)
    root = tree.getroot()
    size = root.find('size')
    w = int(size.find('width').text)
    h = int(size.find('height').text)
    for obj in root.iter('object'):
        difficult = obj.find('difficult').text
        cls = obj.find('name').text
        if cls not in classes or int(difficult) == 1:
            continue
        cls_id = classes.index(cls)
        xmlbox = obj.find('bndbox')
        b = (float(xmlbox.find('xmin').text),
             float(xmlbox.find('xmax').text),
             float(xmlbox.find('ymin').text),
             float(xmlbox.find('ymax').text))
        b1, b2, b3, b4 = b
        # æ ‡æ³¨è¶Šç•Œä¿®æ­£
        if b2 > w:
            b2 = w
        if b4 > h:
            b4 = h
        b = (b1, b2, b3, b4)
        bb = convert((w, h), b)
        out_file.write(str(cls_id) + " " + " ".join([str(a) for a in bb]) + '\n')
 
 
wd = getcwd()
for image_set in sets:
    if not os.path.exists('data/labels/'):
        os.makedirs('data/labels/')
    image_ids = open('data/ImageSets/%s.txt' % (image_set)).read().strip().split()
    list_file = open('data/%s.txt' % (image_set), 'w')
    for image_id in image_ids:
        list_file.write(abs_path + '/data/images/%s.jpg\n' % (image_id))
        convert_annotation(image_id)
    list_file.close()
```

labelme2voc

[labelme/examples/bbox_detection/labelme2voc.py at main Â· wkentaro/labelme](https://github.com/wkentaro/labelme/blob/main/examples/bbox_detection/labelme2voc.py)



## æ•°æ®é›†åˆ’åˆ†

vocåˆ’åˆ†

```python
import os
import random
 
trainval_percent = 0.9
train_percent = 0.9
xmlfilepath = 'data/Annotations'
txtsavepath = 'data/ImageSets'
total_xml = os.listdir(xmlfilepath)
 
num = len(total_xml)
list = range(num)
tv = int(num * trainval_percent)
tr = int(tv * train_percent)
trainval = random.sample(list, tv)
train = random.sample(trainval, tr)
 
ftrainval = open('data/ImageSets/trainval.txt', 'w')
ftest = open('data/ImageSets/test.txt', 'w')
ftrain = open('data/ImageSets/train.txt', 'w')
fval = open('data/ImageSets/val.txt', 'w')
 
for i in list:
    name = total_xml[i][:-4] + '\n'
    if i in trainval:
        ftrainval.write(name)
        if i in train:
            ftrain.write(name)
        else:
            fval.write(name)
    else:
        ftest.write(name)
 
ftrainval.close()
ftrain.close()
fval.close()
ftest.close()
```



# æŒ‡æ ‡

## å‰ç½®çŸ¥è¯†

TP: True Positive, çœŸæ­£ç±»ï¼Œå°†æ­£ç±»é¢„æµ‹æˆæ­£ç±»æ•°ã€‚
TN: True Negtive, çœŸè´Ÿç±»ï¼Œå°†è´Ÿç±»é¢„æµ‹æˆè´Ÿç±»æ•°ã€‚
FP: False Positive, å‡æ­£ç±»ï¼Œå°†è´Ÿç±»é¢„æµ‹æˆæ­£ç±»ã€‚
FN: False Negtive, å‡è´Ÿç±»ï¼Œå°†æ­£ç±»é¢„æµ‹æˆè´Ÿç±»ã€‚

|       | positive | negtive |
| ----- | -------- | ------- |
| true  | TP       | FP      |
| false | FN       | TN      |

## Accuracy

å‡†ç¡®ç‡

Accuracy =  (TP + TN) / (TP + TN + FP+ FN)  

å³é¢„æµ‹æ­£ç¡®çš„å†…å®¹å æ‰€æœ‰å†…å®¹çš„æ¯”ä¾‹

## Precision

ç²¾ç¡®ç‡ 

#åœ¨é¢„æµ‹çš„æ‰€æœ‰æ­£æ ·æœ¬ä¸­ï¼Œé¢„æµ‹æ­£ç¡®çš„æ¯”ä¾‹ 
precision = TP / (TP + FP) 

ç†è§£ï¼šç²¾ç¡®ç‡ä¹Ÿè¢«ç§°ä¸ºæŸ¥å‡†ç‡ï¼Œç”¨äºè¡¡é‡æ£€ç´¢ç»“æœæ˜¯å¦ç²¾å‡†ï¼Œå³æ£€ç´¢ç»“æœä¸­ï¼Œæ£€ç´¢åˆ°çš„ç›¸å…³å†…å®¹å **æœ¬æ¬¡æ£€ç´¢ç»“æœ**çš„æ¯”ä¾‹

## Recall

å¬å›ç‡

#åœ¨æ‰€æœ‰æ­£æ ·æœ¬ä¸­ï¼Œé¢„æµ‹ä¸ºæ­£æ ·æœ¬çš„æ¯”ä¾‹ 
recall = TP / (TP + FN)

ç†è§£ï¼šå¬å›ç‡ä¹Ÿè¢«ç§°ä¸ºæŸ¥å…¨ç‡ï¼Œç”¨äºè¡¡é‡æ£€ç´¢ç»“æœæ˜¯å¦å…¨é¢ï¼Œé—æ¼æƒ…å†µï¼Œå³æ£€ç´¢ç»“æœä¸­ï¼Œæ£€ç´¢åˆ°çš„ç›¸å…³å†…å®¹å **æ€»ç›¸å…³å†…å®¹**çš„æ¯”ä¾‹

## PRæ›²çº¿

å°†é¢„æµ‹ç»“æœçš„PRå€¼ç»˜åˆ¶ä½™åæ ‡è½´ä¸Šï¼Œå³ä¸ºPRæ›²çº¿å›¾ï¼ˆçºµè½´ä¸ºPæ¨ªè½´ä¸ºRï¼‰

![articulated_truck.png](https://segmentfault.com/img/bVbDtp3)

## mAPï¼ˆmean Average Precisionï¼‰

å¹³å‡APï¼Œå¯¹æ¯ä¸ªç±»åˆ«è®¡ç®—APå€¼ï¼Œç„¶åå»å¹³å‡å€¼

AP = PRæ›²çº¿å›¾é¢ç§¯  

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/blog_migrate/a2a754ca23b65dbcc5f3e9b7942ab460.png)

Pä¸ºprecisionç²¾ç¡®ç‡ 

Rä¸ºrecallå¬å›ç‡



æ›²çº¿é¢ç§¯è¶Šå¤§è¯´æ˜APçš„å€¼è¶Šå¤§ï¼Œç±»åˆ«çš„æ£€æµ‹ç²¾åº¦å°±è¶Šé«˜



### mAP@0.5: 

mean Average Precisionï¼ˆIoU=0.5ï¼‰
å³å°†IoUè®¾ä¸º0.5æ—¶ï¼Œè®¡ç®—æ¯ä¸€ç±»çš„æ‰€æœ‰å›¾ç‰‡çš„APï¼Œç„¶åæ‰€æœ‰ç±»åˆ«æ±‚å¹³å‡ï¼Œå³mAPã€‚

### mAP@.5:.95

ï¼ˆmAP@[.5:.95]ï¼‰
è¡¨ç¤ºåœ¨ä¸åŒIoUé˜ˆå€¼ï¼ˆä»0.5åˆ°0.95ï¼Œæ­¥é•¿0.05ï¼‰ï¼ˆ0.5ã€0.55ã€0.6ã€0.65ã€0.7ã€0.75ã€0.8ã€0.85ã€0.9ã€0.95ï¼‰ä¸Šçš„å¹³å‡mAPã€‚



## F1-Score

F1 = 2 * precision * recall /(precision + recall)



## mIOUï¼ˆMean Intersection over Unionï¼‰

miouæ˜¯è¯­ä¹‰åˆ†å‰²ä»»åŠ¡ä¸­çš„æ¨¡å‹è¯„ä¼°æ ‡å‡†, æ¯ä¸ªç±»åˆ«çš„iouå–å¹³å‡ä¹‹åå¾—åˆ°miouã€‚ï¼ˆé¢„æµ‹ç»“æœå’ŒGTæ¡†ä¹‹é—´è®¡ç®—IOUï¼‰

iouçš„è®¡ç®—å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œiou = overlap / unionã€‚

![iou_equation.png](https://segmentfault.com/img/bVbDtSF)

ç›¸å…³åšå®¢ï¼š

[python - ç½‘ç»œè¯„ä¼°ä¹‹mAPå’ŒmIOU - ä¸ªäººæ–‡ç«  - SegmentFault æ€å¦](https://segmentfault.com/a/1190000021783580)





# YOLO



## YOLOV7

### å‚è€ƒåšå®¢

1.[(29 å°ç§ä¿¡ / 80 æ¡æ¶ˆæ¯) æ·±å…¥æµ…å‡º Yolo ç³»åˆ—ä¹‹ Yolov7 åŸºç¡€ç½‘ç»œç»“æ„è¯¦è§£ - çŸ¥ä¹](https://zhuanlan.zhihu.com/p/543743278)

2.[YOLOV7è¯¦ç»†è§£è¯»ï¼ˆä¸€ï¼‰ç½‘ç»œæ¶æ„è§£è¯»-é˜¿é‡Œäº‘å¼€å‘è€…ç¤¾åŒº](https://developer.aliyun.com/article/1268284)

3.[YOLOV7å­¦ä¹ è®°å½•ä¹‹åŸç†+ä»£ç ä»‹ç»_yolov7çš„ä»‹ç»å’ŒåŸç†-CSDNåšå®¢](https://blog.csdn.net/pengxiang1998/article/details/128307956)

4.[(29 å°ç§ä¿¡ / 80 æ¡æ¶ˆæ¯) yoloç³»åˆ—ä¹‹yolov7 - çŸ¥ä¹](https://zhuanlan.zhihu.com/p/679005104)

### æ¨¡å‹ç»“æ„

æ¨¡å‹ç»†èŠ‚ï¼š

![è¯¦è§£YOLOV7 ç½‘ç»œç»“æ„_yolov7ç½‘ç»œç»“æ„-CSDNåšå®¢](https://img-blog.csdnimg.cn/5cb5b3466f61400899b6dd6cf5859c93.png)

![image.png](https://ucc.alicdn.com/pic/developer-ecology/6onfez3baopyo_2690493fa0a24bafb1665d89617ba7ed.png?x-oss-process=image%2Fresize%2Cw_1400%2Cm_lfit%2Fformat%2Cwebp)

![äº’è”ç½‘åŠ ç«èµ› YOLOv7 ç›®æ ‡æ£€æµ‹ç½‘ç»œè§£è¯»-CSDNåšå®¢](https://img-blog.csdnimg.cn/3f046a35f48e43629f83595950ec441c.png)

#### ä¸»å¹²ç½‘ç»œbackbone

é¦–å…ˆ **4** å±‚å·ç§¯å±‚ï¼Œç‰¹å¾å›¾å˜ä¸º 160 * 160 * 128 å¤§å°ã€‚CBS** ä¸»è¦æ˜¯ **Conv + BN + SiLU** æ„æˆï¼Œå›¾ä¸­ç”¨ä¸åŒçš„é¢œè‰²è¡¨ç¤ºä¸åŒçš„ size å’Œ stride, å¦‚ (3, 2) è¡¨ç¤ºå·ç§¯æ ¸å¤§å°ä¸º 3 ï¼Œæ­¥é•¿ä¸º 2ã€‚

å¯¹åº”é…ç½®æ–‡ä»¶ä¸­ï¼š

```
[-1, 1, Conv, [32, 3, 1]],  # 0

 [-1, 1, Conv, [64, 3, 2]],  # 1-P1/2      
 [-1, 1, Conv, [64, 3, 1]],
 
 [-1, 1, Conv, [128, 3, 2]],  # 3-P2/4  
```

elanï¼ˆç”±å¤šä¸ª CBS æ„æˆï¼‰

å¯¹åº”é…ç½®æ–‡ä»¶ä¸­ï¼š

```
[-1, 1, Conv, [64, 1, 1]],# elançš„å•ç‹¬CBSåˆ†æ”¯
[-2, 1, Conv, [64, 1, 1]],# elançš„å¦ä¸€æ¡é•¿åˆ†æ”¯
[-1, 1, Conv, [64, 3, 1]],
[-1, 1, Conv, [64, 3, 1]],
[-1, 1, Conv, [64, 3, 1]],
[-1, 1, Conv, [64, 3, 1]],
[[-1, -3, -5, -6], 1, Concat, [1]],
[-1, 1, Conv, [256, 1, 1]],  # 11
```

**MP** å±‚ ä¸»è¦æ˜¯åˆ†ä¸º Maxpool å’Œ CBS , å…¶ä¸­ MP1 å’Œ MP2 ä¸»è¦æ˜¯é€šé“æ•°çš„æ¯”å˜åŒ–ã€‚

å¯¹åº”é…ç½®æ–‡ä»¶ä¸­ï¼š

```
[-1, 1, MP, []],
[-1, 1, Conv, [128, 1, 1]],
[-3, 1, Conv, [128, 1, 1]],
[-1, 1, Conv, [128, 3, 2]],
[[-1, -3], 1, Concat, [1]],  # 16-P3/8 
```

 4 ä¸ª CBS åï¼Œæ¥å…¥ä¾‹å¦‚ä¸€ä¸ª ELAN ï¼Œç„¶ååé¢å°±æ˜¯ä¸‰ä¸ª MP + ELAN çš„è¾“å‡ºï¼Œå¯¹åº”çš„å°±æ˜¯ C3/C4/C5 çš„è¾“å‡ºï¼Œå¤§å°åˆ†åˆ«ä¸º 80 * 80 * 512 ï¼Œ 40 * 40 * 1024ï¼Œ 20 * 20 * 1024ã€‚ æ¯ä¸€ä¸ª MP ç”± 5 å±‚ï¼Œ ELAN æœ‰ 8 å±‚ï¼Œ æ‰€ä»¥æ•´ä¸ª backbone çš„å±‚æ•°ä¸º 4 + 8 + 13 * 3 = 51 å±‚ï¼Œ ä» 0 å¼€å§‹çš„è¯ï¼Œæœ€åä¸€å±‚å°±æ˜¯ç¬¬ 50 å±‚ã€‚

#### Head

å‡†ç¡®æ¥è¯´Headå¯ä»¥åˆ†ä¸ºä¸¤å—ï¼šFPN-PANå’ŒDetectHead

backbone æœ€åè¾“å‡ºçš„ 32 å€é™é‡‡æ ·ç‰¹å¾å›¾ C5ï¼Œç„¶åç»è¿‡ [SPPCSP](https://zhida.zhihu.com/search?content_id=208965058&content_type=Article&match_order=1&q=SPPCSP&zhida_source=entity)ï¼Œé€šé“æ•°ä»1024å˜ä¸º512ã€‚å…ˆæŒ‰ç…§ top down å’Œ C4ã€C3èåˆï¼Œå¾—åˆ° P3ã€P4 å’Œ P5ï¼›å†æŒ‰ bottom-up å»å’Œ P4ã€P5 åšèåˆã€‚

å¯¹äº **pafpn** è¾“å‡ºçš„ P3ã€P4 å’Œ P5 ï¼Œ ç»è¿‡ [RepConv](https://zhida.zhihu.com/search?content_id=208965058&content_type=Article&match_order=1&q=RepConv&zhida_source=entity) è°ƒæ•´é€šé“æ•°ï¼Œæœ€åä½¿ç”¨ 1x1 å·ç§¯å»é¢„æµ‹ objectnessï¼ˆç½®ä¿¡åº¦ï¼‰ã€classï¼ˆç±»åˆ«ï¼‰ å’Œ bboxï¼ˆé¢„æµ‹æ¡†ï¼‰ ä¸‰éƒ¨åˆ†ã€‚

YOLOV7é¢„è®¾äº†ä¸‰ä¸ªå°ºå¯¸çš„é”šæ¡†ï¼Œå› æ­¤è¾“å‡ºé•¿åº¦ä¸º 3*ï¼ˆ4ï¼ˆboxï¼‰ + NC + 1ï¼ˆobjectnessï¼‰ï¼‰



RepConv åœ¨è®­ç»ƒå’Œæ¨ç†æ˜¯æœ‰ä¸€å®šçš„åŒºåˆ«ã€‚è®­ç»ƒæ—¶æœ‰ä¸‰ä¸ªåˆ†æ”¯çš„ç›¸åŠ è¾“å‡ºï¼Œéƒ¨ç½²æ—¶ä¼šå°†åˆ†æ”¯çš„å‚æ•°é‡å‚æ•°åŒ–åˆ°ä¸»åˆ†æ”¯ä¸Šã€‚

![img](https://pic2.zhimg.com/v2-1f39f33049b838cde8996c08343e1673_1440w.jpg)

**é‡å‚æ•°åŒ–**

ç°æœ‰çš„ç»éªŒæ¥çœ‹ï¼Œåˆ©ç”¨åˆ†æ”¯ï¼Œæ˜¯å¯ä»¥æœ‰æ•ˆå¢åŠ æ¨¡å‹è¡¨å¾å­¦ä¹ èƒ½åŠ›ï¼Œæ¥æå‡ç²¾åº¦çš„ã€‚

ä½†æ˜¯åšåˆ†æ”¯çš„æ—¶å€™ï¼Œå­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œå¤šåˆ†æ”¯ç»“æ„èƒ½æ˜¾è‘—æé«˜æ¨¡å‹æ€§èƒ½ï¼Œä½†æ˜¯åˆä¼šæœ€ç»ˆå¯¼è‡´æ¨¡å‹åœ¨æ¨ç†æ—¶é€Ÿåº¦å˜æ…¢ä¸”è¿˜éå¸¸è€—å†…å­˜ï¼Œè¿™éå¸¸ä¸åˆ©äºå®é™…åœºæ™¯çš„åº”ç”¨ã€‚

é€Ÿåº¦å˜æ…¢å¥½ç†è§£çš„ï¼Œå› ä¸ºç»“æ„å¤æ‚è¿ç®—å¤šäº†ï¼Œå°±æ…¢äº†ã€‚

è¿™æ—¶å°±å‡ºç°æ¨¡å—é‡å‚æ•°åŒ–è§£å†³è¿™ä¸ªé—®é¢˜ã€‚

å°±æ˜¯å°†è®­ç»ƒå’Œæ¨ç†åˆ†å¼€ï¼Œè®­ç»ƒæ˜¯ä¸€ä»¶äº‹æƒ…ï¼Œæ¨ç†åˆæ˜¯ä¸€ä»¶äº‹æƒ…ï¼Œè®­ç»ƒçš„ç½‘ç»œç»“æ„å’Œæµ‹è¯•çš„ç½‘ç»œç»“æ„ä¸ä¸€æ ·ï¼Œå°±å¸¸è¯†æ¥è¯´ï¼Œè®­ç»ƒå’Œæ¨ç†å®ƒç½‘ç»œç»“æ„å¾—ç›¸åŒã€‚è¦ä¸ç„¶ç½‘ç»œç»“æ„æ€æ ·å»èµ°å‘¢ã€‚

- åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­å°†ä¸€ä¸ªæ•´ä½“æ¨¡å—åˆ†å‰²ä¸ºå¤šä¸ªç›¸åŒæˆ–ä¸åŒçš„æ¨¡å—åˆ†æ”¯ã€‚ 
-  åœ¨æ¨ç†è¿‡ç¨‹ä¸­å°†å¤šä¸ªåˆ†æ”¯é›†æˆåˆ°å®Œå…¨ç­‰ä»·çš„æ¨¡å—ï¼ˆRepConvï¼‰ã€‚ 
-  å‡å°‘å‚æ•°æ•°é‡ï¼ŒåŠ å¿«æ¨ç†é€Ÿåº¦ï¼Œæ›´åŠ çœå†…å­˜ã€‚

å®é™…åšæ³•ï¼š

- å·ç§¯å’ŒBNçš„åˆå¹¶ï¼ˆæ•°å­¦æ–¹å¼ï¼‰ 
-  å…¨éƒ¨è½¬æˆ3Ã—3çš„å·ç§¯ã€‚ 
-  æ ¹æ®å·ç§¯å¯åŠ æ€§ï¼Œå¤šä¸ªå·ç§¯æ ¸å†åˆå¹¶ã€‚

![img](https://developer.qcloudimg.com/http-save/yehe-11162134/b7c6503445cfee1a16cd98b7ebfb4758.png)

![img](https://i-blog.csdnimg.cn/blog_migrate/298695691b1239bb521cca9da9c80863.png#pic_center)



å¯¹åº”é…ç½®æ–‡ä»¶ï¼š

```
# FPN-PANç»“æ„
[-1, 1, SPPCSPC, [512]], # 51

 [-1, 1, Conv, [256, 1, 1]],
 [-1, 1, nn.Upsample, [None, 2, 'nearest']],
 [37, 1, Conv, [256, 1, 1]], # route backbone P4  P4ç»è¿‡å·ç§¯åå’ŒP5çš„ä¸Šé‡‡æ ·æ‹¼æ¥
 [[-1, -2], 1, Concat, [1]],
 
 [-1, 1, Conv, [256, 1, 1]], # elanæ¨¡å—
 [-2, 1, Conv, [256, 1, 1]],
 [-1, 1, Conv, [128, 3, 1]],
 [-1, 1, Conv, [128, 3, 1]],
 [-1, 1, Conv, [128, 3, 1]],
 [-1, 1, Conv, [128, 3, 1]],
 [[-1, -2, -3, -4, -5, -6], 1, Concat, [1]],
 [-1, 1, Conv, [256, 1, 1]], # 63
 
 [-1, 1, Conv, [128, 1, 1]],
 [-1, 1, nn.Upsample, [None, 2, 'nearest']],
 [24, 1, Conv, [128, 1, 1]], # route backbone P3  P3ç»è¿‡å·ç§¯åå’Œå…ˆå‰çš„ç‰¹å¾æ‹¼æ¥
 [[-1, -2], 1, Concat, [1]],
 
 ...
 
 
 # detectheadç»“æ„
    [75, 1, RepConv, [256, 3, 1]],
   [88, 1, RepConv, [512, 3, 1]],
   [101, 1, RepConv, [1024, 3, 1]],

   [[102,103,104], 1, Detect, [nc, anchors]],   # Detect(P3, P4, P5)
```



### æŸå¤±å‡½æ•°

- å›å½’æŸå¤±ï¼šCIoU æŸå¤±ï¼ˆæ¯” IoU æŸå¤±æ›´ç²¾å‡†ï¼Œè€ƒè™‘ç›®æ ‡é‡å åº¦ã€ä¸­å¿ƒç‚¹è·ç¦»ã€å®½é«˜æ¯”ï¼‰â†’ è®¡ç®—æ­£æ ·æœ¬é¢„æµ‹æ¡†ä¸ GT æ¡†çš„ä½ç½® / å½¢çŠ¶è¯¯å·®ï¼›
- åˆ†ç±»æŸå¤±ï¼šäº¤å‰ç†µæŸå¤±ï¼ˆCE Lossï¼‰æˆ– Focal Lossâ†’ è®¡ç®—æ­£æ ·æœ¬é¢„æµ‹ç±»åˆ«ä¸çœŸå®ç±»åˆ«çš„è¯¯å·®ï¼ˆFocal Loss ç¼“è§£ç±»åˆ«ä¸å¹³è¡¡ï¼‰ï¼›
- ç½®ä¿¡åº¦æŸå¤±ï¼šäºŒå…ƒäº¤å‰ç†µæŸå¤±ï¼ˆBCE Lossï¼‰â†’ æ­£æ ·æœ¬æ ‡ç­¾ = 1ï¼Œè´Ÿæ ·æœ¬æ ‡ç­¾ = 0ï¼Œè®¡ç®—é¢„æµ‹ç½®ä¿¡åº¦ä¸çœŸå®æ ‡ç­¾çš„è¯¯å·®ã€‚



### æ ‡ç­¾åˆ†é…

æ ‡ç­¾åˆ†é…æŒ‡çš„æ˜¯å°†å›¾ç‰‡çš„æ ‡æ³¨æ¡†(æ ‡ç­¾)ï¼Œä¹Ÿå«åšçœŸå®æ¡†Ground Truthï¼Œå’Œé¢„æµ‹çš„é¢„æµ‹å€¼ç»™å¯¹åº”èµ·æ¥ï¼Œä¾¿äºè¿›ä¸€æ­¥æ±‚æŸå¤±å€¼ã€‚





#### ç®—æ³•æµç¨‹ï¼š

YOLOv5
Step1ï¼šAutoanchorç­–ç•¥ï¼Œè·å¾—æ•°æ®é›†æœ€ä½³åŒ¹é…çš„9ä¸ªanchorï¼ˆå¯é€‰ï¼‰

Step2ï¼šæ ¹æ®GTæ¡†ä¸anchorçš„å®½é«˜æ¯”ï¼Œè¿‡æ»¤æ‰ä¸åˆé€‚çš„anchor
Step3ï¼šé€‰æ‹©GTæ¡†çš„ä¸­å¿ƒç½‘æ ¼ä»¥åŠæœ€é‚»è¿‘çš„2ä¸ªé‚»åŸŸç½‘æ ¼ä½œä¸ºæ­£æ ·æœ¬ç­›é€‰åŒºåŸŸï¼ˆè¾…åŠ©å¤´åˆ™é€‰æ‹©å‘¨å›´4ä¸ªé‚»åŸŸç½‘æ ¼ï¼‰

YOLOX
Step4ï¼šè®¡ç®—GTæ¡†ä¸æ­£æ ·æœ¬IOUå¹¶ä»å¤§åˆ°å°æ’åºï¼Œé€‰å–å‰10ä¸ªå€¼è¿›è¡Œæ±‚å’Œï¼ˆP6å‰20ä¸ªï¼‰ï¼Œå¹¶å–æ•´ä½œä¸ºå½“å‰GTæ¡†çš„Kå€¼ï¼ˆDynamic Kï¼‰
Step5ï¼šæ ¹æ®æŸå¤±å‡½æ•°è®¡ç®—æ¯ä¸ªGTæ¡†å’Œå€™é€‰anchorçš„æŸå¤±ï¼ˆReg Losså’ŒCls Lossï¼‰ï¼Œä¿ç•™æŸå¤±æœ€å°çš„å‰Kä¸ª
Step6ï¼šå»æ‰åŒä¸€ä¸ªanchorè¢«åˆ†é…åˆ°å¤šä¸ªGTæ¡†çš„æƒ…å†µ



step1æ˜¯æ•°æ®é¢„å¤„ç†æ“ä½œï¼Œä¸ºä¸‰ä¸ªæ£€æµ‹å¤´ï¼ˆå¯¹åº”å°ã€ä¸­ã€å¤§ç›®æ ‡ï¼‰å„åˆ†é… 3 ä¸ª anchor å°ºå¯¸ï¼ˆå…± 9 ä¸ªï¼‰ï¼Œä½¿ anchors å°½å¯èƒ½è´´åˆæ•°æ®é›†ä¸­ç›®æ ‡çš„çœŸå®å®½é«˜åˆ†å¸ƒï¼Œæå‡åˆå§‹åŒ¹é…è´¨é‡ã€‚ï¼ˆé€šè¿‡éå†æ‰€æœ‰GTè·å–æœ€ä½³é¢„è®¾å°ºå¯¸ï¼‰

**æ­¥éª¤ï¼š**

1. **æå–æ‰€æœ‰ ground truth bbox çš„å®½é«˜**
   ä»è®­ç»ƒé›†æ‰€æœ‰å›¾åƒçš„æ ‡æ³¨æ–‡ä»¶ï¼ˆå¦‚ COCO çš„ `annotations.json`ï¼‰ä¸­ï¼Œæ”¶é›†æ‰€æœ‰çœŸå®æ¡†çš„ *w*,*h* ï¼ˆå•ä½ï¼šåƒç´ ï¼Œé€šå¸¸å½’ä¸€åŒ–åˆ° [0, 1] æˆ–ä¿æŒåŸå§‹å°ºå¯¸ï¼‰ã€‚

2. è¿è¡Œ k-means èšç±»ï¼ˆk = 9ï¼‰

   - ä½¿ç”¨ 

     IoU è·ç¦»

     ï¼ˆè€Œéæ¬§æ°è·ç¦»ï¼ï¼‰ï¼Œå› ä¸º bbox åŒ¹é…çœ‹çš„æ˜¯é‡å åº¦ã€‚ 

     è·ç¦»åº¦é‡å®šä¹‰ä¸ºï¼š

     *d*(box,anchor)=1âˆ’IoU(box,anchor)

   - åˆå§‹åŒ– 9 ä¸ªèšç±»ä¸­å¿ƒï¼ˆå¯ç”¨ k-means++ï¼‰ï¼›

   - è¿­ä»£ï¼šå°†æ¯ä¸ª gt bbox åˆ†é…ç»™ IoU æœ€å¤§çš„ anchorï¼›æ›´æ–° anchor ä¸ºè¯¥ç°‡ bbox çš„ *centroidï¼ˆæ³¨æ„ï¼šä¸æ˜¯å‡å€¼ï¼éœ€ç”¨ IoU æœ€ä¼˜ä»£è¡¨ï¼‰*ï¼Œå¸¸ç”¨åšæ³•æ˜¯å–è¯¥ç°‡ä¸­ä¸å‡å€¼ bbox IoU æœ€å¤§çš„é‚£ä¸ªä½œä¸ºæ–°ä¸­å¿ƒã€‚

3. æŒ‰å°ºåº¦æ’åºåˆ†é…ç»™ä¸‰ä¸ªæ£€æµ‹å¤´

   - å°† 9 ä¸ª anchors æŒ‰é¢ç§¯ *w*Ã—*h* æ’åºï¼›
   - å‰ 3 ä¸ªï¼ˆæœ€å°ï¼‰â†’ stride=8ï¼ˆå¤§ç‰¹å¾å›¾ï¼Œæ£€æµ‹å°ç›®æ ‡ï¼‰
     ä¸­ 3 ä¸ª â†’ stride=16
     å 3 ä¸ªï¼ˆæœ€å¤§ï¼‰â†’ stride=32ï¼ˆå°ç‰¹å¾å›¾ï¼Œæ£€æµ‹å¤§ç›®æ ‡ï¼‰

> ğŸ“Œ ç¤ºä¾‹ï¼ˆYOLOv5/v7 COCO é»˜è®¤ anchorsï¼‰ï¼š
>
> anchors = [
>
>   [12, 16, 19, 36, 40, 28],      # stride=8
>
>   [36, 75, 76, 55, 72, 146],     # stride=16
>
>   [142, 110, 192, 243, 459, 401] # stride=32
>
> ]
>
> ï¼ˆæ¯ä¸¤ä¸ªæ•°è¡¨ç¤ºä¸€ç»„å®½é«˜ï¼‰



step2åˆæ­¥ç­›æ‰å½¢çŠ¶å·®å¼‚å¤ªå¤§çš„ anchorï¼Œé˜²æ­¢å¼ºè¡ŒæŠŠâ€œç˜¦é«˜ GTâ€åˆ†é…ç»™â€œæ‰å¹³ anchorâ€å¯¼è‡´å›å½’éš¾åº¦çˆ†ç‚¸ï¼›ä¹ŸæŠŠæ•°é‡çº§å…ˆç­›ä¸€éï¼Œåé¢å†ç²¾ç»†ç­›é€‰ã€‚

å¯¹äºæ¯ä¸ªçœŸå®æ¡†ï¼Œæˆ‘ä»¬è®¡ç®—å®ƒä¸æ‰€æœ‰é”šç‚¹çš„åŒ¹é…ç¨‹åº¦ï¼Œé€šå¸¸ä½¿ç”¨å®½é«˜æ¯”ä½œä¸ºè¡¡é‡æ ‡å‡†ã€‚å…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š

1. **è®¡ç®—çœŸå®æ¡†ä¸é”šç‚¹çš„å®½é«˜æ¯”**ï¼š

   $ratio=\frac{minâ¡(w_{gt},h_{gt})}{minâ¡(w_{anchor},h_{anchor})}$

   æˆ–è€…æ›´å¸¸è§çš„ï¼Œè®¡ç®—å®½é«˜æ¯”çš„ç›¸ä¼¼æ€§ï¼š

   $ratio_wh=\frac{w_{gt}}{w_{anchor}}/\frac{h_{gt}}{h_{anchor}}$

2. **è®¾ç½®é˜ˆå€¼**ï¼šé€šå¸¸è®¾å®šä¸€ä¸ªé˜ˆå€¼ï¼ˆä¾‹å¦‚ï¼Œ4.0ï¼‰ï¼Œå¦‚æœçœŸå®æ¡†ä¸é”šç‚¹çš„å®½é«˜æ¯”å°äºé˜ˆå€¼ï¼Œåˆ™è®¤ä¸ºè¿™ä¸ªé”šç‚¹å¯ä»¥ç”¨äºé¢„æµ‹è¯¥çœŸå®æ¡†ã€‚

3. **é€‰æ‹©åŒ¹é…çš„é”šç‚¹**ï¼šå¯¹äºæ¯ä¸ªçœŸå®æ¡†ï¼Œæˆ‘ä»¬é€‰æ‹©ä¸å…¶å®½é«˜æ¯”æœ€æ¥è¿‘çš„é”šç‚¹ï¼ˆå³æ¯”å€¼æœ€æ¥è¿‘1çš„é”šç‚¹ï¼‰ä½œä¸ºæ­£æ ·æœ¬ã€‚åŒæ—¶ï¼ŒYOLOv7ä¹Ÿå…è®¸ä¸€ä¸ªçœŸå®æ¡†åŒ¹é…å¤šä¸ªé”šç‚¹ï¼ˆä¾‹å¦‚ï¼ŒåŒä¸€ä¸ªçœŸå®æ¡†å¯ä»¥åŒ¹é…ä¸‰ä¸ªå°ºåº¦çš„é”šç‚¹ä¸­çš„å¤šä¸ªï¼‰ã€‚



v7çš„æ ‡ç­¾åˆ†é…ç­–ç•¥é›†æˆV5å’ŒYOLOXï¼ŒåŒæ—¶å¼•å…¥é¢å¤–çš„è¾…åŠ©å¤´æ¥æŒ‡å¯¼æ ‡ç­¾åˆ†é…ï¼Œä»è€Œæé«˜æ¨¡å‹çš„æ€§èƒ½ã€‚ï¼ˆæœ‰åšæ–‡è¯´è¯¥ä¸¾æªæ¶¨ç‚¹ä¸å¤šï¼Œåªæœ‰0.3ä¸ªç‚¹ï¼‰

![img](https://developer.qcloudimg.com/http-save/yehe-11162134/5d69eb9dad92bfe4683426056f08189b.png)

aux headæ›´å…³æ³¨äºrecallï¼Œè€Œlead headä»aux headä¸­ç²¾å‡†ç­›é€‰å‡ºæ ·æœ¬ã€‚

åœ¨ä½¿ç”¨lead headå’Œauxiliary headä¸€èµ·ä¼˜åŒ–æ¨¡å‹çš„æ—¶å€™ï¼Œauxiliary headçš„æ­£æ ·æœ¬æ˜¯è¾ƒä¸ºâ€œç²—ç³™çš„â€œï¼Œä¸»è¦æ˜¯é€šè¿‡æ”¾å®½æ­£æ ·æœ¬åˆ†é…è¿‡ç¨‹çš„çº¦æŸæ¥è·å¾—æ›´å¤šçš„æ­£æ ·æœ¬ã€‚lead headä¸­çš„ä¸€ä¸ªanchorå¦‚æœåŒ¹é…ä¸Šground truthï¼Œåˆ™åˆ†é…3ä¸ªæ­£æ ·æœ¬ï¼Œè€ŒåŒæ ·çš„æƒ…å†µä¸‹auxiliary headåˆ†é…5ä¸ªã€‚

lead headä¸­å°†top10ä¸ªæ ·æœ¬IOUæ±‚å’Œå–æ•´ï¼Œè€Œauxiliary headä¸­å–top20ã€‚

auxiliary headçš„å­¦ä¹ èƒ½åŠ›ä¸å¦‚lead headå¼ºï¼Œä¸ºäº†é¿å…ä¸¢å¤±éœ€è¦å­¦ä¹ çš„ä¿¡æ¯ï¼Œå°†é‡ç‚¹ä¼˜åŒ–auxiliary headçš„å¬å›ç‡ã€‚

è€Œlead headå¯ä»¥ä»é«˜recallçš„ç»“æœä¸­ç­›é€‰å‡ºé«˜ç²¾åº¦çš„ç»“æœä½œä¸ºæœ€ç»ˆè¾“å‡ºã€‚lead headå’Œauxiliary headçš„æŸå¤±å‡½æ•°æƒé‡è®¾ç½®ä¸º 4:1ã€‚

æ³¨ï¼šYOLOv7 å¼•å…¥ã€Œè¾…åŠ©æ£€æµ‹å¤´ï¼ˆAuxiliary Headï¼‰ã€ï¼Œæ ¸å¿ƒä½œç”¨æ˜¯**åœ¨è®­ç»ƒé˜¶æ®µæä¾›é¢å¤–ç›‘ç£ä¿¡å·ï¼Œç¼“è§£æ¢¯åº¦æ¶ˆå¤±ï¼Œå¸®åŠ©ä¸»æ£€æµ‹å¤´ï¼ˆLead Headï¼‰æ›´å¿«æ”¶æ•›ã€å­¦ä¹ æ›´é²æ£’çš„ç‰¹å¾**ï¼Œæ¨ç†é˜¶æ®µä»…ç”¨ä¸»æ£€æµ‹å¤´è¾“å‡ºç»“æœï¼ˆè¾…åŠ©å¤´ä¸å‚ä¸æ¨ç†ï¼‰ã€‚

#### 1. è¾…åŠ©å¤´çš„è¾“å‡ºå†…å®¹

è¾…åŠ©å¤´ä¸ä¸»æ£€æµ‹å¤´ç»“æ„å®Œå…¨ä¸€è‡´ï¼Œè¾“å‡º 3 ç±»æ ¸å¿ƒä¿¡æ¯ï¼ˆå’Œä¸»æ£€æµ‹å¤´è¾“å‡ºæ ¼å¼ç›¸åŒï¼‰ï¼š

- å›å½’åˆ†æ”¯ï¼šé¢„æµ‹é”šæ¡†çš„åç§»é‡ï¼ˆdx, dy, dw, dhï¼‰â†’ ç”¨äºä¿®æ­£é”šæ¡†ä½ç½®å’Œå°ºå¯¸ï¼›
- åˆ†ç±»åˆ†æ”¯ï¼šé¢„æµ‹ç›®æ ‡ç±»åˆ«æ¦‚ç‡ï¼ˆå¦‚ COCO æ•°æ®é›† 80 ç±»ï¼‰â†’ åˆ¤å®šç›®æ ‡ç±»åˆ«ï¼›
- ç½®ä¿¡åº¦åˆ†æ”¯ï¼šé¢„æµ‹ â€œè¯¥æ¡†æ˜¯ç›®æ ‡è€ŒéèƒŒæ™¯â€ çš„ç½®ä¿¡åº¦â†’ ç­›é€‰æœ‰æ•ˆé¢„æµ‹æ¡†ã€‚

ç®€å•è¯´ï¼šè¾…åŠ©å¤´å°±æ˜¯ä¸€ä¸ª â€œå¤‡ç”¨æ£€æµ‹å¤´â€ï¼Œè®­ç»ƒæ—¶å’Œä¸»æ£€æµ‹å¤´ä¸€èµ·è¾“å‡ºé¢„æµ‹ç»“æœï¼Œæ¨ç†æ—¶è¢« â€œå…³é—­â€ã€‚

#### 2. è¾…åŠ©å¤´çš„æŸå¤±è®¡ç®—

è¾…åŠ©å¤´çš„æŸå¤±è®¡ç®—é€»è¾‘ä¸ä¸»æ£€æµ‹å¤´å®Œå…¨ä¸€è‡´ï¼Œä¸”**å…±äº«æ ‡ç­¾åˆ†é…ç»“æœ**ï¼ˆå³æ­£è´Ÿæ ·æœ¬åˆ’åˆ†å’Œä¸»æ£€æµ‹å¤´ç›¸åŒï¼‰

YOLOv7 çš„æ€»è®­ç»ƒæŸå¤±æ˜¯ã€Œä¸»æ£€æµ‹å¤´æŸå¤± + è¾…åŠ©æ£€æµ‹å¤´æŸå¤±ã€çš„åŠ æƒå’Œï¼Œå…¬å¼ä¸ºï¼š`Total Loss = Lead_Loss + Î» Ã— Aux_Loss`



![img](https://i-blog.csdnimg.cn/blog_migrate/f0eeed8ee6bb7ad023eb37ccb53d51da.png#pic_center)





### æ£€æµ‹ç»“æœ

**åŸå§‹ç½‘ç»œè¾“å‡ºï¼ˆå³æ£€æµ‹å¤´çš„æœªè§£ç è¾“å‡ºï¼‰** æ˜¯ï¼š

![image](https://img2024.cnblogs.com/blog/3147612/202501/3147612-20250118135725335-1257570824.png)

æµ…å±‚ç‰¹å¾å›¾(80Ã—80)é€‚åˆç”¨äºæ£€æµ‹å°ç‰©ä½“ï¼Œå› ä¸ºå…¶ä¸‹é‡‡æ ·çš„ç¨‹åº¦è¾ƒå°ï¼Œå¯ä»¥ä¿ç•™æ›´å¤šçš„ç»†èŠ‚ä¿¡æ¯ï¼Œå¯ä»¥æƒ³è±¡ä¸€ä¸ªå¾ˆå°çš„ä¸œè¥¿ï¼Œå¦‚æœä¸‹é‡‡æ ·æ·±åº¦è¿‡é«˜ï¼Œå®ƒçš„ä¿¡æ¯å¯èƒ½å°±å’Œå·¨å¤šåƒç´ æ··åœ¨ä¸€èµ·è€Œä¸¢å¤±ï¼Œå› æ­¤è¾ƒæµ…çš„ä¸‹é‡‡æ ·å¯ä»¥æ›´å¥½çš„ç•™ä½å°ç‰©ä½“ã€‚æ·±å±‚ç‰¹å¾å›¾(20Ã—20)é€‚åˆç”¨äºæ£€æµ‹å¤§ç‰©ä½“ï¼Œå› ä¸ºå…¶ä¸‹é‡‡æ ·çš„ç¨‹åº¦è¾ƒå¤§ï¼Œå¯¹äºå¤§ç‰©ä½“æ‰€å åƒç´ æ›´å¤šï¼Œè‹¥æƒ³è·å–å…¶å…¨éƒ¨ä¿¡æ¯å°±éœ€è¦é‡‡æ ·æ›´å¤šçš„åƒç´ ï¼Œå› æ­¤å¯ä»¥æ›´å¥½çš„æ•æ‰åˆ°å¤§ç‰©ä½“çš„ç‰¹å¾ã€‚



å¯¹äºæ¯ä¸ª anchorï¼ˆæˆ–æ¯ä¸ªé¢„æµ‹åˆ†æ”¯ï¼‰ï¼Œæ¯ä¸ª grid cell é¢„æµ‹ï¼š

[ *$t\_x$*, *$t\_y$*, *$t\_w$*,$t\_h$, obj_conf, cls1,â€¦,cls*C* ]



å…¶ä¸­ï¼š

-  *$t\_x$*, *$t\_y$* ï¼š**ç›¸å¯¹äºå½“å‰ grid cell å·¦ä¸Šè§’çš„åç§»é‡ï¼ˆæœªå½’ä¸€åŒ–åæ ‡ï¼Œä½†èŒƒå›´åœ¨ 0~1 é™„è¿‘ï¼‰**
- *$t\_w$*,$t\_h$ï¼š**ç›¸å¯¹äº(é¢„è®¾) anchor å®½é«˜çš„ç¼©æ”¾ç³»æ•°ï¼ˆå¯¹æ•°ç©ºé—´ï¼‰**
- obj_confï¼šobjectness ç½®ä¿¡åº¦
- clsï¼šç±»åˆ«ç½®ä¿¡åº¦ï¼ˆé€šå¸¸ sigmoid æˆ– softmax å¤„ç†ï¼‰





#### è§£ç 

ç”±é¢„æµ‹å¤´éƒ¨åˆ†æˆ‘ä»¬å¯ä»¥è·å¾—ä¸‰ä¸ªç‰¹å¾å±‚çš„é¢„æµ‹ç»“æœï¼Œä»¥COCOä¸ºä¾‹ï¼Œshapeåˆ†åˆ«ä¸º(N,20,20,255)ï¼Œ(N,40,40,255)ï¼Œ(N,80,80,255)çš„æ•°æ®ã€‚

å…¶ä¸­çš„85å¯ä»¥æ‹†åˆ†æˆ4+1+80ã€‚
å‰4ä¸ªå‚æ•°ç”¨äºåˆ¤æ–­æ¯ä¸€ä¸ªç‰¹å¾ç‚¹çš„å›å½’å‚æ•°ï¼Œå›å½’å‚æ•°è°ƒæ•´åå¯ä»¥è·å¾—é¢„æµ‹æ¡†ï¼›
ç¬¬5ä¸ªå‚æ•°ç”¨äºåˆ¤æ–­æ¯ä¸€ä¸ªç‰¹å¾ç‚¹æ˜¯å¦åŒ…å«ç‰©ä½“ï¼›
æœ€å80ä¸ªå‚æ•°ç”¨äºåˆ¤æ–­æ¯ä¸€ä¸ªç‰¹å¾ç‚¹æ‰€åŒ…å«çš„ç‰©ä½“ç§ç±»ã€‚



è·å–é¢„æµ‹æ¡†ä½ç½®ä¿¡æ¯ï¼Œå…·ä½“å…¬å¼å¦‚ä¸‹ï¼š

![image](https://img2024.cnblogs.com/blog/3147612/202501/3147612-20250118135848745-3094700.png)

å…¶ä¸­tx,tyä»¥åŠtw,thä¸ºé¢„æµ‹æ•°æ®ä¹Ÿå°±æ˜¯åŸå§‹çš„è¾“å‡ºæ•°æ®ï¼Œcx,cyä¸ºgrid cellåœ¨åŸå›¾ä¸­çš„å·¦ä¸Šè§’åæ ‡ï¼Œpw,phä¸ºanchorboxçš„å®½é«˜ï¼Œbx,by,bw,bhå³ä¸ºç‰©ä½“åœ¨åŸå›¾ä¸­çš„åæ ‡ä¿¡æ¯ã€‚å…¶ä¸­Ïƒ()å‡½æ•°ä»£è¡¨å¯¹æ•°æ®è¿›è¡Œsigmoidæ“ä½œã€‚





#### å¾—åˆ†ç­›é€‰ä¸NMS

å¾—åˆ†ç­›é€‰å°±æ˜¯ç­›é€‰å‡ºå¾—åˆ†æ»¡è¶³confidenceç½®ä¿¡åº¦çš„é¢„æµ‹æ¡†ã€‚

å¾—åˆ†ç­›é€‰ä¸éæå¤§æŠ‘åˆ¶çš„è¿‡ç¨‹å¯ä»¥æ¦‚æ‹¬å¦‚ä¸‹ï¼š

1ã€æ‰¾å‡ºè¯¥å›¾ç‰‡ä¸­å¾—åˆ†å¤§äºé—¨é™å‡½æ•°çš„æ¡†ã€‚åœ¨è¿›è¡Œé‡åˆæ¡†ç­›é€‰å‰å°±è¿›è¡Œå¾—åˆ†çš„ç­›é€‰å¯ä»¥å¤§å¹…åº¦å‡å°‘æ¡†çš„æ•°é‡ã€‚
2ã€å¯¹ç§ç±»è¿›è¡Œå¾ªç¯ï¼Œéæå¤§æŠ‘åˆ¶çš„ä½œç”¨æ˜¯ç­›é€‰å‡ºä¸€å®šåŒºåŸŸå†…å±äºåŒä¸€ç§ç±»å¾—åˆ†æœ€å¤§çš„æ¡†ï¼Œå¯¹ç§ç±»è¿›è¡Œå¾ªç¯å¯ä»¥å¸®åŠ©æˆ‘ä»¬å¯¹æ¯ä¸€ä¸ªç±»åˆ†åˆ«è¿›è¡Œéæå¤§æŠ‘åˆ¶ã€‚
3ã€æ ¹æ®å¾—åˆ†å¯¹è¯¥ç§ç±»è¿›è¡Œä»å¤§åˆ°å°æ’åºã€‚
4ã€æ¯æ¬¡å–å‡ºå¾—åˆ†æœ€å¤§çš„æ¡†ï¼Œè®¡ç®—å…¶ä¸å…¶å®ƒæ‰€æœ‰é¢„æµ‹æ¡†çš„é‡åˆç¨‹åº¦ï¼Œé‡åˆç¨‹åº¦è¿‡å¤§çš„åˆ™å‰”é™¤ã€‚

æ­¥éª¤

- æŒ‰ç½®ä¿¡åº¦ä»é«˜åˆ°ä½æ’åºï¼›
- é€‰å‡ºåˆ†æ•°æœ€é«˜çš„æ¡†ï¼Œå°†å…¶åŠ å…¥ä¿ç•™åˆ—è¡¨ï¼›
- è®¡ç®—è¯¥æ¡†ä¸å…¶ä½™æ‰€æœ‰æ¡†çš„ IoUï¼›
- ç§»é™¤ IoU å¤§äºé˜ˆå€¼çš„æ¡†ï¼ˆè®¤ä¸ºæ˜¯é‡å¤ï¼‰ï¼›
- é‡å¤ä¸Šè¿°è¿‡ç¨‹ï¼Œç›´åˆ°æ²¡æœ‰æ¡†å‰©ä¸‹ã€‚





```python
import numpy as np

def iou(box1, boxes):
    """è®¡ç®—ä¸€ä¸ªæ¡†ä¸å¤šä¸ªæ¡†çš„IoU"""
    x1 = np.maximum(box1[0], boxes[:, 0])
    y1 = np.maximum(box1[1], boxes[:, 1])
    x2 = np.minimum(box1[2], boxes[:, 2])
    y2 = np.minimum(box1[3], boxes[:, 3])

    inter_area = np.maximum(0, x2 - x1) * np.maximum(0, y2 - y1)
    box1_area = (box1[2] - box1[0]) * (box1[3] - box1[1])
    boxes_area = (boxes[:, 2] - boxes[:, 0]) * (boxes[:, 3] - boxes[:, 1])
    union_area = box1_area + boxes_area - inter_area

    return inter_area / (union_area + 1e-6)

def nms(boxes, scores, iou_threshold=0.5):
    """
    NMS éæå¤§å€¼æŠ‘åˆ¶
    :param boxes: ndarray, shape=(N, 4), æ ¼å¼ [x1, y1, x2, y2]
    :param scores: ndarray, shape=(N,)
    :param iou_threshold: float
    :return: ä¿ç•™çš„ç´¢å¼•åˆ—è¡¨
    """
    if len(boxes) == 0:
        return []

    # æŒ‰åˆ†æ•°ä»é«˜åˆ°ä½æ’åº
    sorted_indices = np.argsort(scores)[::-1]
    keep = []

    while len(sorted_indices) > 0:
        current = sorted_indices[0]
        keep.append(current)

        # è®¡ç®—å½“å‰æ¡†ä¸å…¶ä½™æ¡†çš„ IoU
        current_box = boxes[current]
        rest_boxes = boxes[sorted_indices[1:]]
        ious = iou(current_box, rest_boxes)

        # ä¿ç•™ IoU å°äºé˜ˆå€¼çš„æ¡†
        keep_indices = np.where(ious < iou_threshold)[0]
        sorted_indices = sorted_indices[1:][keep_indices]

    return keep
```



## YOLOV8

### æ¦‚è¿°

æ— é”šæ¡†

é¢„æµ‹é”šæ¡†è¾¹ç•Œåˆ°ä¸­å¿ƒç‚¹ä¹‹é—´çš„è·ç¦»ï¼Œè€Œä¸æ˜¯é¢„è®¾é”šæ¡†å°ºå¯¸

### å‚è€ƒåšå®¢

1.[Yolov 8æºç è¶…è¯¦ç»†é€è¡Œè§£è¯»+ ç½‘ç»œç»“æ„ç»†è®²(è‡ªæˆ‘ç”¨çš„å°ç™½ç¬”è®°)-CSDNåšå®¢](https://blog.csdn.net/chenhaogu/article/details/131647758)

2.[YOLOv8 åŸç†å’Œå®ç°å…¨è§£æ â€” MMYOLO 0.6.0 æ–‡æ¡£](https://mmyolo.readthedocs.io/zh-cn/latest/recommended_topics/algorithm_descriptions/yolov8_description.html)

3.[YOLOV8ç³»åˆ—æ¨¡å‹éƒ¨ç½²ä¸åå¤„ç† | Alex Tech Garden](https://alexw914.github.io/2025/08/03/YOLOV8ç³»åˆ—æ¨¡å‹éƒ¨ç½²ä¸åå¤„ç†/#3-NMS)

æ ‡ç­¾åˆ†é…ï¼š

4.[(29 å°ç§ä¿¡ / 80 æ¡æ¶ˆæ¯) YOLOv8 ç›®æ ‡æ£€æµ‹æ¨¡å‹ åŸç†è§£æ - çŸ¥ä¹](https://zhuanlan.zhihu.com/p/722076107)

5.[(29 å°ç§ä¿¡ / 80 æ¡æ¶ˆæ¯) YOLOv8-è®­ç»ƒæµç¨‹-æ­£è´Ÿæ ·æœ¬åˆ†é… - çŸ¥ä¹](https://zhuanlan.zhihu.com/p/633094573)



### æ¨¡å‹ç»“æ„

![YOLOv8-P5_structure](https://user-images.githubusercontent.com/27466624/222869864-1955f054-aa6d-4a80-aed3-92f30af28849.jpg)

#### ä¸»å¹²ç½‘ç»œbackbone



#### Head

åŒæ ·å¯ä»¥åˆ†ä¸ºNeckï¼ˆFPN-PANï¼‰å’ŒDetectHead



**DetectHead**

åŒ…å«ä¸¤ä¸ªå¤´ï¼šåˆ†ç±»å¤´+boxå¤´

è¾“å‡º`NC+4*regmax`ç»´å‘é‡

åŸä»£ç è®¾ç½®ï¼š

self.reg_max = 16  *# DFL channels (ch[0] // 16 to scale 4/8/12/16/20 for n/s/m/l/x)*

æ£€æµ‹å¤´åªé¢„æµ‹ç±»åˆ«å’Œboxï¼Œå–æ¶ˆobjectnessåˆ†æ”¯ï¼Œç”±åˆ†ç±»å¤´ç¡®å®šç½®ä¿¡åº¦

regmaxæœ‰4ç»„ï¼Œåˆ†åˆ«é¢„æµ‹è¾¹ç•Œæ¡†çš„ 4 ä¸ªåæ ‡lã€tã€bã€rï¼ˆå·¦ä¸Šå³ä¸‹ï¼‰ï¼Œæ¯ä¸ªåæ ‡å€¼éƒ½æœ‰ 16 ä¸ªç¦»æ•£ç‚¹è¿›è¡Œé¢„æµ‹ã€‚å¯¹ç¦»æ•£åŒ–çš„åæ ‡ l,t,r,b åº”ç”¨ softmaxï¼Œå¾—åˆ°æ¯ä¸ªç¦»æ•£å€¼çš„æ¦‚ç‡åˆ†å¸ƒã€‚ä¾‹å¦‚ï¼Œå¯¹äºlï¼Œsoftmax ä¼šè¾“å‡ºä¸€ä¸ª 16 ç»´çš„å‘é‡ï¼Œ**æ¯ä¸ªå…ƒç´ ä»£è¡¨è¯¥ç¦»æ•£å€¼çš„æ¦‚ç‡**ã€‚å‚è€ƒåšå®¢ï¼š[(29 å°ç§ä¿¡ / 80 æ¡æ¶ˆæ¯) YOLOv8 ç›®æ ‡æ£€æµ‹æ¨¡å‹ åŸç†è§£æ - çŸ¥ä¹](https://zhuanlan.zhihu.com/p/722076107)

![img](https://pic1.zhimg.com/v2-1c702ab8cd66d309d8462b9522bf5028_1440w.jpg)

è§£ç æ–¹æ³•ï¼šé¦–å…ˆå¯¹16ä¸ªä¸€ç»„çš„åæ ‡å€¼è¿›è¡Œè®¡ç®—**Softmax**ï¼Œä¸regmaxçš„16ä¸ªç´¢å¼•å€¼ç›¸ä¹˜åç›¸åŠ ï¼Œå¾—åˆ°æœ€ç»ˆçš„åæ ‡å€¼(è¿™é‡Œè®¡ç®—çš„æ˜¯ä¸€ä¸ªæœŸæœ›å€¼)ã€‚å¾—åˆ°è¾“å‡ºåï¼Œæ ¹æ®ä¸­å¿ƒç‚¹è®¡ç®—åæ ‡å›å½’ï¼Œè¿™é‡Œçš„ä¸­å¿ƒç‚¹æ˜¯æ¯ä¸ªé¢„æµ‹æ–¹æ ¼çš„ä¸­å¿ƒç‚¹ã€‚

```python
C, H, W = output.shape                           # [66, 160, 160]
output = output.reshape(C, -1).T                 # [160x160, 66]                                 
bbox_dfl = output[:, :NUM_BINS * 4].reshape(-1, 4, NUM_BINS)  #[160x160, 4, 16]

prob = softmax(bbox_dfl, axis=-1)                  
proj = np.arange(NUM_BINS, dtype=np.float32)      # [0, 1, 2, ... 15]        
bbox = np.sum(prob * proj, axis=-1) * stride      # [160x160, 4]

y, x = np.divmod(np.arange(H * W), W)
grid_x = (x * stride + stride / 2)
grid_y = (y * stride + stride / 2)                # æ„é€ ä¸­å¿ƒç‚¹åæ ‡

x1 = (grid_x - bbox[:, 0])                        # åæ ‡å›å½’
y1 = (grid_y - bbox[:, 1])
x2 = (grid_x + bbox[:, 2])
y2 = (grid_y + bbox[:, 3])

```



ç±»åˆ«é¢„æµ‹è¾ƒä¸ºç®€å•ï¼Œå¯¹æ¯ä¸ªé¢„æµ‹ç±»åˆ«è¾“å‡ºåšsigmoidå³å¯, å³å¯å¾—åˆ°æœ€ç»ˆçš„ç½®ä¿¡åº¦ã€‚(éƒ¨åˆ†ç½‘ç»œå¯èƒ½ä½¿ç”¨Softmaxè®¡ç®—ï¼Œç”¨äºè¾“å‡º**ä¸å¯èƒ½åŒæ—¶æ»¡è¶³ä¸¤ä¸ªç±»åˆ«**çš„æƒ…å†µ)ï¼Œç±»åˆ«å¤§äºconf_threshé˜ˆå€¼éœ€è¦ä½¿ç”¨NMSè¿›è¡Œè¿›ä¸€æ­¥è¿‡æ»¤ã€‚



### æŸå¤±å‡½æ•°

#### DFLæŸå¤±(Distribution Focal Loss)

ç”¨äºè®¡ç®—é”šæ¡†è¾¹ç•Œåˆ†å¸ƒæŸå¤±

**ç¦»æ•£æ¦‚ç‡åˆ†å¸ƒå»ºæ¨¡**

DFLå°†è¿ç»­åæ ‡å€¼å»ºæ¨¡ä¸º**ç¦»æ•£åŒºé—´ä¸Šçš„æ¦‚ç‡åˆ†å¸ƒ**ã€‚å‡è®¾åæ ‡çœŸå®å€¼ä¸º yï¼Œå°†å…¶ç¦»æ•£åŒ–ä¸º n ä¸ªç‚¹ {y0,y1,...,ynâˆ’1}ï¼Œæ¨¡å‹é¢„æµ‹æ¯ä¸ªç‚¹çš„æ¦‚ç‡ P(yi)ã€‚

**2. ç§¯åˆ†è®¡ç®—è¿ç»­å€¼**

é€šè¿‡åŠ æƒæ±‚å’Œï¼ˆç§¯åˆ†ï¼‰å¾—åˆ°æœ€ç»ˆé¢„æµ‹åæ ‡ï¼š

![img](https://i-blog.csdnimg.cn/direct/2d2119439d334c1e8430c1aea846be40.png)

**ç¤ºä¾‹**ï¼š

![img](https://i-blog.csdnimg.cn/direct/f6f0b72ca825491987f5324a95e5ebed.png)

#### CIOUæŸå¤±



#### åˆ†ç±»æŸå¤±



### æ ‡ç­¾åˆ†é…

TaskAlignedAssignerç­–ç•¥

åŒ¹é…ç­–ç•¥ç®€å•æ€»ç»“ä¸ºï¼šæ ¹æ®åˆ†ç±»ä¸å›å½’çš„åˆ†æ•°åŠ æƒçš„åˆ†æ•°é€‰æ‹©æ­£æ ·æœ¬ã€‚

ï¼ˆä»»åŠ¡å¯¹é½åº¦é‡ï¼Œæ¢åšå…¶ä»–ä»»åŠ¡å¯èƒ½æ˜¯å…¶ä»–åˆ†æ•°çš„åŠ æƒåˆ†æ•°è¿›è¡Œåº¦é‡ï¼‰

ç¬¬ä¸€æ­¥ï¼šç­›é€‰æ­£æ ·æœ¬

1.å¯¹æ¯ä¸ªçœŸå®æ¡†GTï¼Œä»¥align_metricåŒ¹é…ç¨‹åº¦æ’åºï¼Œé€‰å–[topK](https://so.csdn.net/so/search?q=topK&spm=1001.2101.3001.7020)ä¸ªé¢„æµ‹æ¡†ä½œä¸ºæ­£æ ·æœ¬ã€‚

é¦–å…ˆç­›é€‰é”šç‚¹(ç‰¹å¾å›¾gridçš„åæ ‡ä¸­å¿ƒç‚¹)è½åœ¨gt_boxä¸­, å¾—åˆ°mask_in_gt((Tensor): shape(b, n_boxes, h*w)), å…¶ä¸­1ä»£è¡¨é”šç‚¹è½åœ¨gt_boxä¸­, 0è¡¨ç¤ºé”šç‚¹æœªè½åœ¨gt_boxä¸­ã€‚å¦‚ä¸‹å›¾æ‰€ç¤º

![img](https://pica.zhimg.com/v2-8339e82960acb15fa061a466924b40c4_1440w.jpg)



ç¬¬äºŒæ­¥ï¼šè®¡ç®—åŒ¹é…ç¨‹åº¦

1.è®¡ç®—å¯¹é½åˆ†æ•°

å…¬å¼å¦‚ä¸‹ï¼š
$$
align\_{metric} =s^\alpha * u^\beta
$$
sæ˜¯é¢„æµ‹ç±»åˆ«åˆ†å€¼ï¼Œuæ˜¯é¢„æµ‹æ¡†å’ŒçœŸå®æ¡†çš„ciouå€¼ï¼Œâ€˜ Î± â€˜ å’Œâ€˜ Î² â€˜ ä¸ºæƒé‡è¶…å‚æ•°ï¼Œä¸¤è€…ç›¸ä¹˜å°±å¯ä»¥è¡¡é‡åŒ¹é…ç¨‹åº¦ï¼Œå½“åˆ†ç±»çš„åˆ†å€¼è¶Šé«˜ä¸”ciouè¶Šé«˜æ—¶ï¼Œalign_metricçš„å€¼å°±è¶Šæ¥è¿‘äº1,æ­¤æ—¶é¢„æµ‹æ¡†å°±ä¸çœŸå®æ¡†è¶ŠåŒ¹é…ï¼Œå°±è¶Šç¬¦åˆæ­£æ ·æœ¬çš„æ ‡å‡†ã€‚
è¯¥åº¦é‡ç»“åˆäº†åˆ†ç±»ç½®ä¿¡åº¦å’ŒIoUå€¼ï¼Œç”¨äºå…¨é¢è¡¡é‡é”šç‚¹çš„è´¨é‡ã€‚

ä¸‹å›¾å·¦è¾¹æ˜¯ä»»åŠ¡å¯¹é½åº¦é‡ï¼Œå³è¾¹æ˜¯IoUé‡å åº¦é‡ã€‚

![img](https://pic3.zhimg.com/v2-fb14546ff280d4b803527a0866d9f020_1440w.jpg)

ç¬¬ä¸‰æ­¥ï¼š

é€šè¿‡ select_topk_candidates å‡½æ•°ä»æ‰€æœ‰å€™é€‰çš„é”šç‚¹ä¸­ï¼Œé€‰æ‹©ä¸æ¯ä¸ªGTæ¡† å¯¹é½åº¦é‡ æœ€é«˜çš„å‰Kä¸ªé”šç‚¹ï¼Œå¹¶ä¸ºè¿™äº›é”šç‚¹ç”Ÿæˆç›¸åº”çš„æ©ç  mask_topkã€‚

![img](https://pic3.zhimg.com/v2-f24f39b6ef49eb76204cec57cb05173a_1440w.jpg)



ç¬¬å››æ­¥ï¼š

å°†å‰ä¸‰æ­¥ç”Ÿæˆçš„æ‰€æœ‰æ©ç è¿›è¡Œåˆå¹¶ï¼Œå¾—åˆ°æœ€ç»ˆçš„æ­£æ ·æœ¬Maskã€‚

åŒæ—¶å¯¹ä¸€ä¸ªé¢„æµ‹æ¡†ä¸å¤šä¸ªçœŸå®æ¡†åŒ¹é…æµ‹æƒ…å†µè¿›è¡Œå¤„ç†ï¼Œä¿ç•™ciouå€¼æœ€å¤§çš„çœŸå®æ¡†ã€‚

å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå·¦å³ä¸¤ä¸ªçœŸå®æ¡†æœ‰ä¸€ä¸ªé¢„æµ‹æ¡†é‡åˆï¼Œæˆ‘ä»¬ä¿ç•™iouæ›´é«˜çš„ï¼Œèˆå»ç»¿è‰²çš„

![img](https://pica.zhimg.com/v2-fa1d73b5d43a3af6605165acc23b1550_1440w.jpg)

ä»£ç ï¼š[yolov8æ­£è´Ÿæ ·æœ¬æ ‡ç­¾åˆ†é…ç­–ç•¥ä»£ç è§£æ_yolov8æ­£è´Ÿæ ·æœ¬åˆ†é…-CSDNåšå®¢](https://blog.csdn.net/shilichangtin/article/details/135126709)



### ç–‘é—®ï¼š

1.ä¸ç®¡è´Ÿæ ·æœ¬ï¼Ÿè´Ÿæ ·æœ¬æ˜¯å¦å‚ä¸æŸå¤±è®¡ç®—

2.æ¯ä¸ªå°ºåº¦ç‰¹å¾å›¾éƒ½ä¼šåˆ†é…gtå—ï¼Œæˆ–è€…é¢„æµ‹ï¼Ÿ



### è¾“å‡ºè§£ç 

å°†4*regmax çš„dflé¢„æµ‹è½¬ä¸º 4ç»´çš„boxä¿¡æ¯ï¼Œå…¶ä½™å’Œå‰å‡ ä»£åšæ³•ç›¸åŒ

![head](https://user-images.githubusercontent.com/17425982/212816206-33815716-3c12-49a2-9c37-0bd85f941bec.png)





## è¶…å‚æ•°

| åºå· | å‚æ•°                | å€¼     | å«ä¹‰ä¸è§£é‡Š                                                   |
| ---- | ------------------- | ------ | ------------------------------------------------------------ |
| 1    | `--model`/`--cfg`   | YOLOv7 | æŒ‡å®šæ¨¡å‹ç»“æ„æ–‡ä»¶ï¼ˆå¦‚`yolov7.yaml`ï¼‰ã€‚ âš ï¸ æ³¨æ„ï¼šä¸æ˜¯å­—ç¬¦ä¸²`"YOLOV7"`ï¼Œè€Œæ˜¯`.yaml`é…ç½®è·¯å¾„ï¼›æƒé‡åˆå§‹åŒ–é€šå¸¸ç”¨`--weights yolov7.pt`ã€‚ |
| 2    | `--epochs`          | 300    | æ€»è®­ç»ƒè½®æ•°ï¼ˆéå†å…¨éƒ¨è®­ç»ƒé›†çš„æ¬¡æ•°ï¼‰ã€‚ âœ… 300 å¯¹ä¸­ç­‰è§„æ¨¡æ•°æ®é›†è¾ƒåˆç†ï¼›è‹¥æ•°æ®å°‘ï¼ˆå¦‚ <1k å›¾åƒï¼‰ï¼Œå¯èƒ½è¿‡æ‹Ÿåˆ â†’ å¯å‡è‡³ 100~200ï¼›è‹¥ç”¨`--resume`ç»­è®­ï¼Œ**ä¸ä¼šé‡ç½® epoch è®¡æ•°**ã€‚ |
| 3    | `--batch-size`      | 16     | æ¯æ‰¹é€å…¥ GPU çš„å›¾åƒæ•°ã€‚ âœ… 16 æ˜¯ 16GB æ˜¾å­˜ï¼ˆå¦‚ RTX 3090ï¼‰è¾ƒç¨³å¦¥å€¼ï¼›è‹¥ OOMï¼ˆæ˜¾å­˜æº¢å‡ºï¼‰ï¼Œå¯è®¾ä¸º 8 æˆ–ç”¨`--batch-size -1`ï¼ˆè‡ªåŠ¨ç¼©æ”¾è‡³æœ€å¤§ï¼‰ã€‚ ğŸ“Œ*æ³¨ï¼šbatch è¶Šå¤§ï¼Œè®­ç»ƒè¶Šç¨³ï¼Œä½†æ˜¾å­˜å‹åŠ›è¶Šå¤§*ã€‚ |
| 4    | `--img-size`        | 640    | è¾“å…¥å›¾åƒè¢« resize åˆ°`640Ã—640`ï¼ˆä¿æŒå®½é«˜æ¯”ï¼ŒçŸ­è¾¹=640ï¼Œé•¿è¾¹â‰¤640 + paddingï¼‰ã€‚ âœ… 640 æ˜¯ YOLOv7 é»˜è®¤å€¼ï¼Œå¹³è¡¡é€Ÿåº¦ä¸ç²¾åº¦ï¼›å°ç›®æ ‡å¤šï¼Ÿå¯è¯• 800ï¼›è¿½æ±‚é€Ÿåº¦ï¼Ÿå¯è¯• 416ã€‚ |
| 5    | `--rect`            | True   | **çŸ©å½¢è®­ç»ƒï¼ˆRectangular Trainingï¼‰**ï¼š â†’ åŒ batch å†…å›¾åƒæŒ‰**æœ€å¤§å…¬å…±å°ºå¯¸**å¯¹é½ï¼ˆå‡å°‘ paddingï¼‰ï¼Œæå‡ GPU åˆ©ç”¨ç‡ & è®­ç»ƒé€Ÿåº¦ï¼ˆçº¦å¿« 30%ï¼‰ã€‚ âš ï¸ æ¨ç†æ—¶ä»éœ€æ ‡å‡† square è¾“å…¥ï¼ˆå¦‚ 640Ã—640ï¼‰ã€‚ |
| 6    | `--resume`          | True   | ä»æœ€è¿‘ä¿å­˜çš„ checkpointï¼ˆå¦‚`last.pt`ï¼‰**ç»§ç»­è®­ç»ƒ**ï¼Œ**è‡ªåŠ¨æ¢å¤ epochã€optimizer çŠ¶æ€ç­‰**ã€‚ âœ… ä¸­æ–­åç»­è®­å¿…å¤‡ï¼›é¦–æ¬¡è®­ç»ƒåº”ä¸º`False`ã€‚ |
| 7    | `--nosave`          | False  | æ˜¯å¦**ä¿å­˜ checkpoint**ï¼š `False`â†’ ä¿å­˜`best.pt`å’Œ`last.pt`ï¼› `True`â†’ åªä¿å­˜æœ€ç»ˆæ¨¡å‹ï¼ˆçœç£ç›˜ç©ºé—´ï¼‰ã€‚ âœ… å»ºè®®ä¿æŒ`False`ï¼Œæ–¹ä¾¿ä¸­æ–­æ¢å¤æˆ–é€‰æœ€ä½³æ¨¡å‹ã€‚ |
| 8    | `--notest`          | False  | æ˜¯å¦**è·³è¿‡æ¯ä¸ª epoch åçš„ val é˜¶æ®µ**ï¼š `False`â†’ æ¯ epoch éƒ½ valï¼ˆå¾— mAPï¼‰ï¼› `True`â†’ åªæœ€å val ä¸€æ¬¡ï¼ˆå¿«ï¼Œä½†ä¸çŸ¥ä¸­é—´æ€§èƒ½ï¼‰ã€‚ âœ… å°æ•°æ®é›†å»ºè®®`False`ï¼ˆç›‘æ§è¿‡æ‹Ÿåˆï¼‰ï¼›å¤§æ•°æ®é›†å¯è®¾`True`åŠ é€Ÿã€‚ |
| 9    | `--noautoanchor`    | True   | **ç¦ç”¨è‡ªåŠ¨ anchor ä¼˜åŒ–**ï¼š YOLO é»˜è®¤ç”¨ k-means èšç±»è®­ç»ƒé›† bbox å¾— anchorï¼› `True`â†’**å¼ºåˆ¶ä½¿ç”¨ cfg ä¸­é¢„è®¾ anchor**ï¼ˆå¦‚ COCO çš„ï¼‰ã€‚ âœ… è‹¥ä½ æ•°æ®é›† bbox åˆ†å¸ƒä¸ COCO å·®å¼‚å¤§ï¼ˆå¦‚å…¨æ˜¯ç»†é•¿ç›®æ ‡ï¼‰ï¼Œå»ºè®®è®¾ä¸º`False`è®©å…¶è‡ªåŠ¨ä¼˜åŒ–ï¼å¦åˆ™å¯èƒ½æ‰ç‚¹ã€‚ |
| 10   | `--evolve`          | False  | æ˜¯å¦**è¶…å‚è¿›åŒ–ï¼ˆé—ä¼ ç®—æ³•è°ƒå‚ï¼‰**ï¼š `True`â†’ ç”¨å¤šè½®è®­ç»ƒæœç´¢æœ€ä¼˜è¶…å‚ï¼ˆè€—æ—¶ 10x+ï¼‰ï¼› `False`â†’ ç”¨å½“å‰è¶…å‚è®­ç»ƒã€‚ âœ… é€šå¸¸`False`ï¼›é™¤éä½ æœ‰å¤§é‡ç®—åŠ› & æ—¶é—´ã€‚ |
| 11   | `--cos-lr`          | 0.001  | â— æ­¤å¤„æœ‰è¯¯ï¼š`cos-lr`æ˜¯**å¸ƒå°”å¼€å…³**ï¼Œæ§åˆ¶æ˜¯å¦ç”¨**ä½™å¼¦é€€ç«å­¦ä¹ ç‡**ï¼› ä½ å†™çš„`0.001`åº”è¯¥æ˜¯`--lr0`ï¼ˆåˆå§‹å­¦ä¹ ç‡ï¼‰ã€‚ âœ… æ¨èï¼š `bash<br>--cos-lr # å¯ç”¨ä½™å¼¦é€€ç«ï¼ˆé»˜è®¤ï¼‰<br>--lr0 0.01 # åˆå§‹ lrï¼ˆbatch=64 æ—¶ï¼‰ï¼›batch=16 æ—¶å»ºè®® lr0=0.01Ã—(16/64)=0.0025<br>` |
| 12   | `--label-smoothing` | 0.1    | æ ‡ç­¾å¹³æ»‘ï¼ˆLabel Smoothingï¼‰ï¼šé˜²æ­¢æ¨¡å‹è¿‡æ‹Ÿåˆåˆ° one-hot æ ‡ç­¾ã€‚ â†’ å°†çœŸå®æ ‡ç­¾`1`â†’`1 - Îµ`ï¼Œå…¶ä½™`0`â†’`Îµ/(n-1)`ï¼ˆÎµ=0.1ï¼‰ã€‚ âœ… å¯¹å°æ•°æ®é›† & å°ç±»åˆ«æœ‰ç›Šï¼ˆå¦‚ä½ æåˆ°çš„æ ·æœ¬ä¸å‡è¡¡ï¼‰ï¼Œæ¨è 0.0~0.2ã€‚ |
| 13   | `--patience`        | 30     | **æ—©åœè€å¿ƒå€¼ï¼ˆEarly Stoppingï¼‰**ï¼š â†’ è‹¥ val æŸå¤±è¿ç»­ 30 è½®æœªæ”¹å–„ï¼Œåˆ™æå‰åœæ­¢è®­ç»ƒã€‚ âœ… 30 è¾ƒåˆç†ï¼›æ•°æ®å°‘å¯å‡è‡³ 10~15ï¼›é…åˆ`--notest False`ä½¿ç”¨ã€‚ |
| 14   | `--multi-scale`     | Â±50%   | å¤šå°ºåº¦è®­ç»ƒï¼šæ¯ batch éšæœºç¼©æ”¾å›¾åƒå°ºå¯¸åœ¨`[0.5Ã—img_size, 1.5Ã—img_size]`ï¼ˆå³ 320~960ï¼‰ã€‚ âœ…**å¢å¼ºæ³›åŒ–æ€§**ï¼Œå°¤å…¶å¯¹å°ºåº¦å˜åŒ–å¤§çš„ç›®æ ‡ï¼ˆå¦‚è¿œè¿‘è½¦è¾†ï¼‰ï¼›ä½†å¢åŠ è®­ç»ƒæ—¶é—´ ~20%ã€‚ |
| 15   | `--single-cls`      | 0      | æ˜¯å¦å°†**æ‰€æœ‰ç±»åˆ«è§†ä¸ºä¸€ç±»**è®­ç»ƒï¼ˆç”¨äºè¿ç§»å­¦ä¹ æˆ–äºŒåˆ†ç±»åœºæ™¯ï¼‰ã€‚ `0`/`False`â†’ å¤šåˆ†ç±»ï¼›`1`/`True`â†’ åˆå¹¶ä¸º single classã€‚ âœ… ä½ åšå¤šç±»åˆ«åˆ†ç±»ï¼ˆå¦‚è®¾å¤‡è¯†åˆ«ï¼‰ï¼Œåº”ä¸º`0`æˆ–çœç•¥ã€‚ |

è§£é‡Šï¼š

ä¸€ã€`--evolve`ï¼šæœç´¢**æœ€ä½³è®­ç»ƒè¶…å‚æ•°**ï¼ˆ**è®­ç»ƒå‰ / è®­ç»ƒé—´**ï¼‰

ğŸ” æœ¬è´¨ï¼š

> **ç¦»çº¿ã€å…¨å±€ã€è¯•é”™å¼ä¼˜åŒ–**ï¼šæ‰¾ä¸€å¥—èƒ½è®©æ¨¡å‹**æœ€ç»ˆæ”¶æ•›æ•ˆæœæœ€å¥½**çš„è¶…å‚æ•°ç»„åˆã€‚ 

ğŸ¯ ç›®æ ‡ï¼š

- æå‡ **æœ€ç»ˆæ¨¡å‹çš„ mAP / Recall / Precision**
- æ‰¾åˆ°å¯¹**ä½ çš„ç‰¹å®šæ•°æ®é›†**æœ€é²æ£’çš„è®­ç»ƒé…ç½®

ğŸ”§ å®ƒè°ƒå“ªäº›å‚æ•°ï¼Ÿï¼ˆä¸¾å‡ ä¸ªå…³é”®ä¾‹å­ï¼‰

| ç±»åˆ«            | å‚æ•°                                   | ä½œç”¨                     |
| --------------- | -------------------------------------- | ------------------------ |
| **ä¼˜åŒ–å™¨**      | `lr0`,`lrf`,`momentum`,`weight_decay`  | æ§åˆ¶å­¦ä¹ å¿«æ…¢ & ç¨³å®šæ€§    |
| **æŸå¤±æƒé‡**    | `box`,`cls`,`obj`                      | å¹³è¡¡å®šä½/åˆ†ç±»/ç½®ä¿¡åº¦æŸå¤± |
| **æ•°æ®å¢å¼º**    | `hsv_h/s/v`,`degrees`,`mosaic`,`mixup` | æ§åˆ¶å›¾åƒæ‰°åŠ¨å¼ºåº¦         |
| **Anchor ç›¸å…³** | `anchor_t`                             | æ§åˆ¶æ­£è´Ÿæ ·æœ¬åŒ¹é…é˜ˆå€¼     |

âœ… **ç±»æ¯”**ï¼š
åƒé€‰â€œå¨å¸ˆ + é…æ–¹ + ç«å€™â€â€”â€”`evolve` å°è¯• 300 ä¸ªå¨å¸ˆï¼Œæ¯äººç”¨ä¸åŒé…æ–¹åšä¸€é”…æ±¤ï¼ˆå®Œæ•´è®­ç»ƒï¼‰ï¼Œæœ€åé€‰æœ€å¥½å–çš„é‚£é”…çš„é…æ–¹ã€‚

**äºŒã€`EMA`ï¼ˆExponential Moving Averageï¼‰ï¼šå¹³æ»‘æ¨¡å‹æƒé‡ï¼ˆè®­ç»ƒé˜¶æ®µï¼‰**

ğŸ” æœ¬è´¨ï¼š

> **åœ¨çº¿ã€å±€éƒ¨ã€ç¨³å®šåŒ–æŠ€æœ¯**ï¼šä¸æ”¹å˜è¶…å‚æ•°ï¼Œè€Œæ˜¯**è®©æ¨¡å‹æƒé‡æ›´ç¨³å®šã€æ³›åŒ–æ›´å¥½**ï¼Œemaä¸å‚ä¸æŸå¤±è®¡ç®—æˆ–è€…ä¼˜åŒ–ï¼Œåªæ˜¯å•çº¯å¹³æ»‘æƒé‡ã€‚ ä½¿ç”¨emaç›¸å…³æƒé‡é€šå¸¸è¡¨ç°æ›´å¥½ï¼Œæ›´å…·å¤‡æ³›åŒ–æ€§

ğŸ“Œ å®˜æ–¹ YOLOv7 é»˜è®¤å¼€å¯ï¼ˆä»£ç ä¸­ `--ema` é€šå¸¸ä¸º Trueï¼Œæ— éœ€æ˜¾å¼åŠ ï¼‰

ğŸ”§ åŸç†ï¼ˆæç®€ç‰ˆï¼‰ï¼š

è®­ç»ƒæ—¶ç»´æŠ¤ä¸¤å¥—æƒé‡ï¼š

- `model`ï¼š**å®æ—¶æƒé‡**ï¼Œæ¯æ­¥ SGD æ›´æ–°ï¼Œéœ‡è¡å¤§ï¼›

- `ema_model`ï¼š**å½±å­æƒé‡ï¼ˆEMAï¼‰**ï¼ŒæŒ‰å…¬å¼ç¼“æ…¢æ›´æ–°ï¼š

  $ema\_weight_t = Î²*â‹…ema\_weight_t*âˆ’1+(1âˆ’ Î² )â‹…model\_weight_t $

  å…¶ä¸­ *Î²* æ¥è¿‘ 1ï¼ˆå¦‚ 0.999ï¼‰ï¼Œæ‰€ä»¥ EMA æƒé‡æ˜¯**å†å²æƒé‡çš„æŒ‡æ•°åŠ æƒå¹³å‡**ã€‚

ä»£ç ï¼š

```python
class ModelEMA:
    def __init__(self, model, decay=0.9999):
        self.ema = deepcopy(model).eval()  # å½±å­æ¨¡å‹ï¼Œåˆå§‹ = model
        self.updates = 0
        self.decay = lambda x: decay * (1 - math.exp(-x / 2000))  # warm-up decay

    def update(self, model):
        with torch.no_grad():
            self.updates += 1
            d = self.decay(self.updates)      # å½“å‰è¡°å‡ç‡ Î²ï¼ŒåˆæœŸå°ï¼ŒåæœŸè¶‹è¿‘ 0.9999
            msd = model.state_dict()          # å®æ—¶æ¨¡å‹æƒé‡ dict
            for k, v in self.ema.state_dict().items():
                if v.dtype.is_floating_point:
                    v *= d                    # ema = ema * Î²
                    v += (1 - d) * msd[k].detach()  # + (1-Î²) * model_weight
```

æœ‰å…¬å¼å¯çŸ¥è¡°å‡ç‡åˆæœŸå°ï¼ŒåæœŸå¤§

```
Weight Value
  â†‘
  |                          â— model (å®æ—¶ï¼Œéœ‡è¡å¤§)
  |                        â†—
  |                      â†—
  |        EMA (å¹³æ»‘) â—â†—
  |                â†—
  |              â†—
  |  â— (åˆå§‹ = model åˆå§‹å€¼)
  +--------------------------------â†’ Training Steps
   0
```

- èµ·ç‚¹é‡åˆï¼ˆâœ… åˆå§‹åŒ– = model åˆå§‹æƒé‡ï¼‰ï¼›
- å‰æœŸ EMA è¿½å¾—å¿«ï¼ˆwarm-up decay å°ï¼‰ï¼›
- åæœŸ EMA èµ°å¾—ç¨³ï¼ˆdecay å¤§ï¼‰ã€‚